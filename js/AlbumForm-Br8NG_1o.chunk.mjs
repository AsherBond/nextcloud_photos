(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".manage-collaborators[data-v-13596046]{display:flex;flex-direction:column;padding:20px;height:500px}.manage-collaborators__title[data-v-13596046]{font-weight:700}.manage-collaborators__subtitle[data-v-13596046]{color:var(--color-text-lighter)}.manage-collaborators__public-link-button[data-v-13596046]{margin:4px 0}.manage-collaborators__form[data-v-13596046]{margin-top:4px 0;display:flex;flex-direction:column}.manage-collaborators__form__input[data-v-13596046]{position:relative;display:block}.manage-collaborators__form__input input[data-v-13596046]{width:100%;padding-left:34px}.manage-collaborators__form__input .loading-icon[data-v-13596046]{position:absolute;top:8px;right:8px}.manage-collaborators__form__list[data-v-13596046]{padding:8px;height:350px;overflow:scroll}.manage-collaborators__form__list__result[data-v-13596046]{padding:8px;border-radius:100px;box-sizing:border-box}.manage-collaborators__form__list__result[data-v-13596046],.manage-collaborators__form__list__result *[data-v-13596046]{cursor:pointer!important}.manage-collaborators__form__list__result[data-v-13596046]:hover{background:var(--color-background-dark)}.manage-collaborators__form__list--empty[data-v-13596046]{margin:100px 0}.manage-collaborators__selection[data-v-13596046]{display:flex;flex-direction:column;margin-top:32px;flex-grow:1}.manage-collaborators__selection__item[data-v-13596046]{border-radius:var(--border-radius-pill);padding:0 8px}.manage-collaborators__selection__item[data-v-13596046]:hover{background:var(--color-background-dark)}.manage-collaborators__selection__item[data-v-13596046] .option{gap:4px}.manage-collaborators .actions[data-v-13596046]{display:flex;margin-top:8px}.manage-collaborators .actions__public-link[data-v-13596046]{display:flex;align-items:center}.manage-collaborators .actions__public-link button[data-v-13596046]{margin-left:8px}.manage-collaborators .actions__slot[data-v-13596046]{flex-grow:1;display:flex;justify-content:flex-end;align-items:center}.album-form[data-v-29b03159]{display:flex;flex-direction:column;height:350px;padding:calc(var(--default-grid-baseline) * 4)}.album-form .form-title[data-v-29b03159]{font-weight:700}.album-form .form-subtitle[data-v-29b03159]{color:var(--color-text-lighter)}.album-form .form-inputs[data-v-29b03159]{flex:1;display:flex;flex-direction:column;gap:calc(var(--default-grid-baseline) * 4)}.album-form .form-buttons[data-v-29b03159]{display:flex;justify-content:space-between;flex-direction:column}.album-form .form-buttons .left-buttons[data-v-29b03159],.album-form .form-buttons .right-buttons[data-v-29b03159]{display:flex;gap:calc(var(--default-grid-baseline) * 4)}.album-form .form-buttons .right-buttons[data-v-29b03159]{justify-content:flex-end}.left-buttons[data-v-29b03159]{flex-grow:1}@media only screen and (max-width: 1020px){.right-buttons[data-v-29b03159]{justify-content:flex-end;flex-direction:column}}")),document.head.appendChild(a)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();
import{A as n,E as b,Q as p,e as c,f as s,R as r,r as m,S as h,o as d}from"./index-CYNaqKNs.chunk.mjs";import{M as C}from"./MapMarker-CwCyILXV.chunk.mjs";import{n as o,a3 as y}from"./index-Y-UlKA14.chunk.mjs";import{S as f}from"./Send-DNQRPiqH.chunk.mjs";import{t as u,F as g,_ as k,g as _,a8 as v}from"./vue.runtime.esm-Cvc35Ey2.chunk.mjs";import{C as L}from"./Close-BZjlrH3B.chunk.mjs";import{A as N}from"./AccountGroup-DqZTstGM.chunk.mjs";import{S as l}from"./index-BycAmYAy.chunk.mjs";import{F as A}from"./FetchCollectionContentMixin-VQw2L6ZW.chunk.mjs";const S={name:"AccountMultiplePlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var w=function(){var t=this,a=t._self._c;return a("span",t._b({staticClass:"material-design-icon account-multiple-plus-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[a("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M19 17V19H7V17S7 13 13 13 19 17 19 17M16 8A3 3 0 1 0 13 11A3 3 0 0 0 16 8M19.2 13.06A5.6 5.6 0 0 1 21 17V19H24V17S24 13.55 19.2 13.06M18 5A2.91 2.91 0 0 0 17.11 5.14A5 5 0 0 1 17.11 10.86A2.91 2.91 0 0 0 18 11A3 3 0 0 0 18 5M8 10H5V7H3V10H0V12H3V15H5V12H8Z"}},[t.title?a("title",[t._v(t._s(t.title))]):t._e()])])])},x=[],M=o(S,w,x,!1,null,null);const V=M.exports,$={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var B=function(){var t=this,a=t._self._c;return a("span",t._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[a("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[t.title?a("title",[t._v(t._s(t.title))]):t._e()])])])},F=[],H=o($,B,F,!1,null,null);const z=H.exports,P={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var I=function(){var t=this,a=t._self._c;return a("span",t._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[a("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[t.title?a("title",[t._v(t._s(t.title))]):t._e()])])])},T=[],E=o(P,I,T,!1,null,null);const K=E.exports,R={name:"EarthIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var U=function(){var t=this,a=t._self._c;return a("span",t._b({staticClass:"material-design-icon earth-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[a("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M17.9,17.39C17.64,16.59 16.89,16 16,16H15V13A1,1 0 0,0 14,12H8V10H10A1,1 0 0,0 11,9V7H13A2,2 0 0,0 15,5V4.59C17.93,5.77 20,8.64 20,12C20,14.08 19.2,15.97 17.9,17.39M11,19.93C7.05,19.44 4,16.08 4,12C4,11.38 4.08,10.78 4.21,10.21L9,15V16A2,2 0 0,0 11,18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[t.title?a("title",[t._v(t._s(t.title))]):t._e()])])])},G=[],O=o(R,U,G,!1,null,null);const Z=O.exports,Y="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20id='mdi-account-group'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M12,5.5A3.5,3.5%200%200,1%2015.5,9A3.5,3.5%200%200,1%2012,12.5A3.5,3.5%200%200,1%208.5,9A3.5,3.5%200%200,1%2012,5.5M5,8C5.56,8%206.08,8.15%206.53,8.42C6.38,9.85%206.8,11.27%207.66,12.38C7.16,13.34%206.16,14%205,14A3,3%200%200,1%202,11A3,3%200%200,1%205,8M19,8A3,3%200%200,1%2022,11A3,3%200%200,1%2019,14C17.84,14%2016.84,13.34%2016.34,12.38C17.2,11.27%2017.62,9.85%2017.47,8.42C17.92,8.15%2018.44,8%2019,8M5.5,18.25C5.5,16.18%208.41,14.5%2012,14.5C15.59,14.5%2018.5,16.18%2018.5,18.25V20H5.5V18.25M0,20V18.5C0,17.11%201.89,15.94%204.45,15.6C3.86,16.28%203.5,17.22%203.5,18.25V20H0M24,20H20.5V18.25C20.5,17.22%2020.14,16.28%2019.55,15.6C22.11,15.94%2024,17.11%2024,18.5V20Z'%20/%3e%3c/svg%3e",D={name:"CollaboratorsSelectionForm",components:{Close:L,AccountGroup:N,ContentCopy:K,Check:z,Earth:Z,NcButton:c,NcListItemIcon:p,NcSelect:b},mixins:[A],props:{albumName:{type:String,required:!0},collaborators:{type:Array,default:()=>[]},allowPublicLink:{type:Boolean,default:!0}},data(){return{searchText:null,availableCollaborators:{},selectedCollaboratorsKeys:[],currentSearchResults:[],loadingCollaborators:!1,randomId:Math.random().toString().substring(2,10),publicLinkCopied:!1,collaboratorTypes:l,config:{minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0}}},computed:{searchResults(){return this.currentSearchResults.filter(({id:t})=>t!==_()?.uid).map(t=>({...t,key:`${t.type}:${t.id}`,iconSvg:t.type===l.Group?Y:void 0})).filter(({key:t})=>!this.selectedCollaboratorsKeys.includes(t))},listableSelectedCollaboratorsKeys(){return this.selectedCollaboratorsKeys.filter(t=>this.availableCollaborators[t].type!==l.Link)},selectedCollaborators(){return this.selectedCollaboratorsKeys.map(t=>this.availableCollaborators[t])},isPublicLinkSelected(){return this.selectedCollaboratorsKeys.includes(`${l.Link}`)},publicLink(){return this.availableCollaborators[l.Link]},publicLinkURL(){return`${window.location.protocol}//${window.location.host}${k(`apps/photos/public/${this.publicLink.id}`)}`},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},watch:{collaborators(t){this.populateCollaborators(t)}},mounted(){this.populateCollaborators(this.collaborators)},methods:{...n(["updateCollection"]),async searchCollaborators(t){if(t!==void 0&&(t=t.trim(),!(t.length<this.config.minSearchStringLength)))try{this.loadingCollaborators=!0;const a=await m.get(g("core/autocomplete/get"),{params:{search:t,itemType:"share-recipients",shareTypes:[l.User,l.Group]}});this.currentSearchResults=a.data.ocs.data.map(e=>{switch(e.source){case"users":return{id:e.id,label:e.label,type:l.User};case"groups":return{id:e.id,label:e.label,type:l.Group};default:throw new Error(`Invalid collaborator source ${e.source}`)}}),this.availableCollaborators={...this.availableCollaborators,...this.currentSearchResults.reduce(this.indexCollaborators,{})}}catch(a){this.errorFetchingCollaborators=a,s.error(this.t("photos","Failed to fetch collaborators list."),{error:a}),r(this.t("photos","Failed to fetch collaborators list."))}finally{this.loadingCollaborators=!1}},populateCollaborators(t){const a=t.reduce(this.indexCollaborators,{});this.selectedCollaboratorsKeys=Object.keys(a),this.availableCollaborators={3:{id:"",label:this.t("photos","Public link"),type:l.Link},...this.availableCollaborators,...a}},indexCollaborators(t,a){return{...t,[`${a.type}${a.type===l.Link?"":":"}${a.type===l.Link?"":a.id}`]:a}},async createPublicLinkForAlbum(){this.selectEntity(`${l.Link}`),await this.updateAlbumCollaborators(),await this.fetchCollection(this.albumFileName,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},async deletePublicLink(){this.unselectEntity(`${l.Link}`),this.availableCollaborators[3]={id:"",label:this.t("photos","Public link"),type:l.Link},this.publicLinkCopied=!1,await this.updateAlbumCollaborators()},async updateAlbumCollaborators(){try{await this.updateCollection({collectionFileName:this.albumFileName,properties:{collaborators:this.selectedCollaborators}})}catch(t){s.error("[PublicAlbumContent] Error updating album",{error:t}),r(this.t("photos","Failed to update album."))}},async copyPublicLink(){await navigator.clipboard.writeText(this.publicLinkURL),this.publicLinkCopied=!0,setTimeout(()=>{this.publicLinkCopied=!1},1e4)},selectEntity(t){this.searchText=null,!this.selectedCollaboratorsKeys.includes(t)&&this.selectedCollaboratorsKeys.push(t)},unselectEntity(t){const a=this.selectedCollaboratorsKeys.indexOf(t);a!==-1&&this.selectedCollaboratorsKeys.splice(a,1)},t:u}};var j=function(){var t=this,a=t._self._c;return a("div",{staticClass:"manage-collaborators"},[a("h2",{staticClass:"manage-collaborators__title"},[t._v(" "+t._s(t.t("photos","Add collaborators"))+" ")]),a("form",{staticClass:"manage-collaborators__form",on:{submit:function(e){e.preventDefault()}}},[a("NcSelect",{attrs:{"input-id":"sharing-search-input","input-label":t.t("photos","Add people or groups who can edit your album"),loading:t.loadingCollaborators,label:"label",filterable:!1,placeholder:t.t("photos","Search people or groups"),"clear-search-on-blur":()=>!1,"user-select":!0,"append-to-body":!1,options:t.searchResults},on:{search:t.searchCollaborators,"option:selected":({key:e})=>t.selectEntity(e)},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}},[t._v(" "+t._s(t.t("photos","No recommendations. Start typing."))+" ")])],1),a("ul",{staticClass:"manage-collaborators__selection"},t._l(t.listableSelectedCollaboratorsKeys,function(e){return a("li",{key:e,staticClass:"manage-collaborators__selection__item"},[a("NcListItemIcon",{attrs:{id:t.availableCollaborators[e].id,"display-name":t.availableCollaborators[e].label,name:t.availableCollaborators[e].label,user:t.availableCollaborators[e].id,"is-no-user":t.availableCollaborators[e].type!==t.collaboratorTypes.User}},[t.availableCollaborators[e].type===t.collaboratorTypes.Group?a("AccountGroup",{attrs:{title:t.t("photos","Group")}}):t._e(),a("NcButton",{attrs:{type:"tertiary","aria-label":t.t("photos","Remove {collaboratorLabel} from the collaborators list",{collaboratorLabel:t.availableCollaborators[e].label})},on:{click:function(i){return t.unselectEntity(e)}}},[a("Close",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)],1)}),0),a("div",{staticClass:"actions"},[t.allowPublicLink?a("div",{staticClass:"actions__public-link"},[t.isPublicLinkSelected&&t.publicLink.id!==""?[a("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{"aria-label":t.t("photos","Copy the public link"),title:t.publicLinkURL},on:{click:t.copyPublicLink},scopedSlots:t._u([{key:"icon",fn:function(){return[t.publicLinkCopied?a("Check"):a("ContentCopy")]},proxy:!0}],null,!1,845538853)},[t.publicLinkCopied?[t._v(" "+t._s(t.t("photos","Public link copied!"))+" ")]:[t._v(" "+t._s(t.t("photos","Copy public link"))+" ")]],2),a("NcButton",{attrs:{type:"tertiary","aria-label":t.t("photos","Delete the public link")},on:{click:t.deletePublicLink}},[a("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:a("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{disabled:t.isPublicLinkSelected&&t.publicLink.id==="","aria-label":t.t("photos","Create public link share")},on:{click:t.createPublicLinkForAlbum}},[a("Earth",{attrs:{slot:"icon"},slot:"icon"}),t._v(" "+t._s(t.t("photos","Share via public link"))+" ")],1)],2):t._e(),a("div",{staticClass:"actions__slot"},[t._t("default",null,{collaborators:t.selectedCollaborators})],2)])])},q=[],Q=o(D,j,q,!1,null,"13596046");const J=Q.exports,W={name:"AlbumForm",components:{MapMarker:C,AccountMultiplePlus:V,Send:f,NcButton:c,NcLoadingIcon:d,NcTextField:h,CollaboratorsSelectionForm:J},props:{album:{type:Object,default:null},displayBackButton:{type:Boolean,default:!1}},data(){return{showCollaboratorView:!1,albumName:"",albumLocation:"",loading:!1}},computed:{editMode(){return this.album!==null},sharingEnabled(){return OC.Share!==void 0},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},mounted(){this.editMode&&(this.albumName=this.album.basename,this.albumLocation=this.album.location??""),this.$nextTick(()=>{this.$refs.nameInput.$el.getElementsByTagName("input")[0].focus()})},methods:{...n(["createCollection","renameCollection","updateCollection"]),submit(t=[]){this.albumName===""||this.loading||(this.editMode?this.handleUpdateAlbum():this.handleCreateAlbum(t))},async handleCreateAlbum(t=[]){try{this.loading=!0;let a=await this.createCollection({collection:{basename:this.albumName,filename:this.albumFileName,nbItems:0,location:this.albumLocation,lastPhoto:-1,date:y().format("MMMM YYYY"),collaborators:t,source:v(`dav/${this.albumFileName}`)}});if(a===void 0)return;(this.albumLocation!==""||t.length!==0)&&(a=await this.updateCollection({collectionFileName:this.albumFileName,properties:{location:this.albumLocation,collaborators:t}})),this.$emit("done",{album:a})}finally{this.loading=!1}},async handleUpdateAlbum(){try{this.loading=!0;let t={...this.album};this.album.basename!==this.albumName&&(t=await this.renameCollection({collectionFileName:this.album.filename,newBaseName:this.albumName})),this.album.location!==this.albumLocation&&(t=await this.updateCollection({collectionFileName:t.filename,properties:{location:this.albumLocation}})),this.$emit("done",{album:t})}finally{this.loading=!1}},back(){this.$emit("back")},t:u}};var X=function(){var t=this,a=t._self._c;return t.showCollaboratorView?a("CollaboratorsSelectionForm",{attrs:{"album-name":t.albumName,"allow-public-link":!1},scopedSlots:t._u([{key:"default",fn:function({collaborators:e}){return[a("span",{staticClass:"left-buttons"},[a("NcButton",{attrs:{type:"tertiary"},on:{click:function(i){t.showCollaboratorView=!1}}},[t._v(" "+t._s(t.t("photos","Back"))+" ")])],1),a("span",{staticClass:"right-buttons"},[a("NcButton",{attrs:{type:"primary",disabled:t.albumName.trim()===""||t.loading},on:{click:function(i){return t.submit(e)}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.loading?a("NcLoadingIcon",{attrs:{size:20}}):a("Send",{attrs:{size:20}})]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.editMode?t.t("photos","Save"):t.t("photos","Create album"))+" ")])],1)]}}])}):a("form",{staticClass:"album-form",on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[a("div",{staticClass:"form-inputs"},[a("NcTextField",{ref:"nameInput",attrs:{value:t.albumName,type:"text",name:"name",required:!0,label:t.t("photos","Name of the album")},on:{"update:value":function(e){t.albumName=e}}}),a("NcTextField",{attrs:{value:t.albumLocation,name:"location",type:"text",label:t.t("photos","Location of the album")},on:{"update:value":function(e){t.albumLocation=e}},scopedSlots:t._u([{key:"default",fn:function(){return[a("MapMarker",{attrs:{size:20}})]},proxy:!0}],null,!1,2964444886)})],1),a("div",{staticClass:"form-buttons"},[a("span",{staticClass:"left-buttons"},[t.displayBackButton?a("NcButton",{attrs:{type:"tertiary"},on:{click:t.back}},[t._v(" "+t._s(t.t("photos","Back"))+" ")]):t._e()],1),a("span",{staticClass:"right-buttons"},[t.sharingEnabled&&!t.editMode?a("NcButton",{attrs:{type:"secondary",disabled:t.albumName.trim()===""||t.loading},on:{click:function(e){t.showCollaboratorView=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[a("AccountMultiplePlus",{attrs:{size:20}})]},proxy:!0}],null,!1,3656768963)},[t._v(" "+t._s(t.t("photos","Add collaborators"))+" ")]):t._e(),a("NcButton",{attrs:{type:"primary",disabled:t.albumName===""||t.loading},on:{click:function(e){return t.submit()}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.loading?a("NcLoadingIcon",{attrs:{size:20}}):a("Send",{attrs:{size:20}})]},proxy:!0}],null,!1,2302891232)},[t._v(" "+t._s(t.editMode?t.t("photos","Save"):t.t("photos","Create album"))+" ")])],1)])])},tt=[],at=o(W,X,tt,!1,null,"29b03159");const bt=at.exports;export{bt as A,J as C};
//# sourceMappingURL=AlbumForm-Br8NG_1o.chunk.mjs.map
