import{x as a,o as r,f as n}from"./index-py_2m8-F.chunk.mjs";import{_ as l}from"./vue.runtime.esm-K-L1yEsQ.chunk.mjs";import{N as g}from"./NcEmptyContent-g9nttIbV.chunk.mjs";import{l as c,n as i}from"./icons-CCMXs15V.chunk.mjs";import{A as o}from"./AbortControllerMixin-DeafVJKx.chunk.mjs";import"./index-D-GU54Qs.chunk.mjs";const h={name:"TagCover",components:{ImageMultipleIcon:c},mixins:[o],props:{tag:{type:Object,required:!0}},data(){return{loadCover:!1,observer:null}},computed:{...a(["files","tags"]),coverUrl(){return this.loadCover?l(`/core/preview?fileId=${this.tag.referenceFileid}&x=512&y=512&forceIcon=0&a=1`):""},count(){return this.tag.filesAssigned}},watch:{loadCover(){this.tag.filesAssigned||this.$store.dispatch("fetchTagFiles",{id:this.tag.id,signal:this.abortController.signal})}},mounted(){this.observer=new IntersectionObserver(t=>{t[0].isIntersecting&&(this.loadCover=!0,this.observer.disconnect())}),this.observer.observe(this.$el)}};var d=function(){var t=this,s=t._self._c;return s("router-link",{staticClass:"tag-cover",attrs:{to:`/tags/${t.tag.displayName}`}},[t.tag.filesAssigned!==0?s("img",{staticClass:"tag-cover__image",attrs:{src:t.coverUrl}}):s("div",{staticClass:"tag-cover__image tag-cover__image--placeholder"},[s("ImageMultipleIcon",{attrs:{size:128}})],1),s("div",{staticClass:"tag-cover__details"},[s("div",{staticClass:"tag-cover__details__first-line"},[s("h3",{staticClass:"tag-cover__details__name"},[t._v(" "+t._s(t.t("recognize",t.tag.displayName))+" ")])]),s("div",{staticClass:"tag-cover__details__second-line"},[t._v(" "+t._s(t.n("photos","%n photo","%n photos",t.count))+" ")])])])},p=[],m=i(h,d,p,!1,null,"3f8c5577");const v=m.exports,u={name:"Tags",components:{TagCover:v,NcLoadingIcon:r,NcEmptyContent:g},mixins:[o],data(){return{error:null,loading:!1,showTags:!1}},computed:{...a(["files","tags","tagsNames"]),tagsList(){return Object.keys(this.tagsNames).map(t=>this.tags[this.tagsNames[t]]).filter(t=>t&&t.id)},popularTags(){return Object.keys(this.tagsNames).filter(t=>this.tags[this.tagsNames[t]].filesAssigned>50).sort((t,s)=>(this.tags[this.tagsNames[s]].filesAssigned||this.tagCounts[s])-(this.tags[this.tagsNames[t]].filesAssigned||this.tagCounts[t])).slice(0,9).map(t=>this.tags[this.tagsNames[t]])}},async beforeMount(){await this.fetchRootContent()},methods:{async fetchRootContent(){OCA.Viewer.close(),this.error=null;try{this.tagsList.length||(this.loading=!0,await this.$store.dispatch("fetchAllTags",{signal:this.abortController.signal}))}catch(t){n.error(t),this.error=!0}finally{this.loading=!1}}}};var _=function(){var t=this,s=t._self._c;return s("div",[t.error?s("NcEmptyContent",{attrs:{name:t.t("photos","An error occurred")}}):t._e(),!t.loading&&t.tagsList.length===0?s("NcEmptyContent",{attrs:{name:t.t("photos","No tags yet"),description:t.t("photos","Photos with tags will show up here")}}):t._e(),t.loading?s("NcLoadingIcon",{staticClass:"loader"}):s("div",{staticClass:"container"},[t.popularTags.length?s("h2",[t._v(" "+t._s(t.t("photos","Popular tags"))+" ")]):t._e(),s("div",{staticClass:"popular-tags"},t._l(t.popularTags,function(e){return s("TagCover",{key:e.id,attrs:{tag:e}})}),1),t.tagsList.length?s("h2",[t._v(" "+t._s(t.t("photos","All tags"))+" ")]):t._e(),s("div",{staticClass:"tags"},t._l(t.tagsList,function(e){return s("TagCover",{key:e.id,attrs:{tag:e}})}),1)])],1)},f=[],C=i(u,_,f,!1,null,"97ef01c0");const I=C.exports;export{I as default};
//# sourceMappingURL=Tags-XUmmrfTc.chunk.mjs.map
