(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".manage-collaborators[data-v-e0508b86]{display:flex;flex-direction:column;padding:20px;height:500px}.manage-collaborators__title[data-v-e0508b86]{font-weight:700}.manage-collaborators__subtitle[data-v-e0508b86]{color:var(--color-text-lighter)}.manage-collaborators__public-link-button[data-v-e0508b86]{margin:4px 0}.manage-collaborators__form[data-v-e0508b86]{margin-top:4px 0;display:flex;flex-direction:column}.manage-collaborators__form__input[data-v-e0508b86]{position:relative;display:block}.manage-collaborators__form__input input[data-v-e0508b86]{width:100%;padding-left:34px}.manage-collaborators__form__input .loading-icon[data-v-e0508b86]{position:absolute;top:8px;right:8px}.manage-collaborators__form__list[data-v-e0508b86]{padding:8px;height:350px;overflow:scroll}.manage-collaborators__form__list__result[data-v-e0508b86]{padding:8px;border-radius:100px;box-sizing:border-box}.manage-collaborators__form__list__result[data-v-e0508b86],.manage-collaborators__form__list__result *[data-v-e0508b86]{cursor:pointer!important}.manage-collaborators__form__list__result[data-v-e0508b86]:hover{background:var(--color-background-dark)}.manage-collaborators__form__list--empty[data-v-e0508b86]{margin:100px 0}.manage-collaborators__selection[data-v-e0508b86]{display:flex;flex-direction:column;margin-top:32px;flex-grow:1}.manage-collaborators__selection__item[data-v-e0508b86]{border-radius:var(--border-radius-pill);padding:0 8px}.manage-collaborators__selection__item[data-v-e0508b86]:hover{background:var(--color-background-dark)}.manage-collaborators__selection__item[data-v-e0508b86] .option{gap:4px}.manage-collaborators .actions[data-v-e0508b86]{display:flex;margin-top:8px}.manage-collaborators .actions__public-link[data-v-e0508b86]{display:flex;align-items:center}.manage-collaborators .actions__public-link button[data-v-e0508b86]{margin-left:8px}.manage-collaborators .actions__slot[data-v-e0508b86]{flex-grow:1;display:flex;justify-content:flex-end;align-items:center}.album-form[data-v-6b58e552]{display:flex;flex-direction:column;height:350px;padding:calc(var(--default-grid-baseline) * 4)}.album-form .form-title[data-v-6b58e552]{font-weight:700}.album-form .form-subtitle[data-v-6b58e552]{color:var(--color-text-lighter)}.album-form .form-inputs[data-v-6b58e552]{flex:1;display:flex;flex-direction:column;gap:calc(var(--default-grid-baseline) * 4)}.album-form .form-buttons[data-v-6b58e552]{display:flex;justify-content:space-between;flex-direction:column}.album-form .form-buttons .left-buttons[data-v-6b58e552],.album-form .form-buttons .right-buttons[data-v-6b58e552]{display:flex;gap:calc(var(--default-grid-baseline) * 4)}.album-form .form-buttons .right-buttons[data-v-6b58e552]{justify-content:flex-end}.left-buttons[data-v-6b58e552]{flex-grow:1}@media only screen and (max-width: 1020px){.right-buttons[data-v-6b58e552]{justify-content:flex-end;flex-direction:column}}")),document.head.appendChild(a)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();
import{A as c,E as p,Q as m,e as u,f as r,R as n,r as d,S as h,o as C}from"./index-C-nSEKko.chunk.mjs";import{M as _}from"./MapMarker-CgE-v1Jq.chunk.mjs";import{n as i,a3 as y}from"./index-BGGeUZyp.chunk.mjs";import{S as f}from"./Send-CNb2uY9Q.chunk.mjs";import{t as b,F as g,_ as v,g as k,a8 as A}from"./vue.runtime.esm-CShV2ddg.chunk.mjs";import{C as S}from"./Close-Dmosf-cz.chunk.mjs";import{A as N}from"./AccountGroup-8Tdb_ENm.chunk.mjs";import{T as o}from"./index-C-6-aqFr.chunk.mjs";import{F as L}from"./FetchCollectionContentMixin-BQBuyj10.chunk.mjs";const E={name:"AccountMultiplePlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var w=function(){var a=this,e=a._self._c;return e("span",a._b({staticClass:"material-design-icon account-multiple-plus-icon",attrs:{"aria-hidden":a.title?null:"true","aria-label":a.title,role:"img"},on:{click:function(l){return a.$emit("click",l)}}},"span",a.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:a.fillColor,width:a.size,height:a.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M19 17V19H7V17S7 13 13 13 19 17 19 17M16 8A3 3 0 1 0 13 11A3 3 0 0 0 16 8M19.2 13.06A5.6 5.6 0 0 1 21 17V19H24V17S24 13.55 19.2 13.06M18 5A2.91 2.91 0 0 0 17.11 5.14A5 5 0 0 1 17.11 10.86A2.91 2.91 0 0 0 18 11A3 3 0 0 0 18 5M8 10H5V7H3V10H0V12H3V15H5V12H8Z"}},[a.title?e("title",[a._v(a._s(a.title))]):a._e()])])])},P=[],H=i(E,w,P,!1,null,null);const x=H.exports,M={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var R=function(){var a=this,e=a._self._c;return e("span",a._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":a.title?null:"true","aria-label":a.title,role:"img"},on:{click:function(l){return a.$emit("click",l)}}},"span",a.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:a.fillColor,width:a.size,height:a.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[a.title?e("title",[a._v(a._s(a.title))]):a._e()])])])},T=[],V=i(M,R,T,!1,null,null);const $=V.exports,B={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var F=function(){var a=this,e=a._self._c;return e("span",a._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":a.title?null:"true","aria-label":a.title,role:"img"},on:{click:function(l){return a.$emit("click",l)}}},"span",a.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:a.fillColor,width:a.size,height:a.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[a.title?e("title",[a._v(a._s(a.title))]):a._e()])])])},I=[],K=i(B,F,I,!1,null,null);const Y=K.exports,z={name:"EarthIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var U=function(){var a=this,e=a._self._c;return e("span",a._b({staticClass:"material-design-icon earth-icon",attrs:{"aria-hidden":a.title?null:"true","aria-label":a.title,role:"img"},on:{click:function(l){return a.$emit("click",l)}}},"span",a.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:a.fillColor,width:a.size,height:a.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M17.9,17.39C17.64,16.59 16.89,16 16,16H15V13A1,1 0 0,0 14,12H8V10H10A1,1 0 0,0 11,9V7H13A2,2 0 0,0 15,5V4.59C17.93,5.77 20,8.64 20,12C20,14.08 19.2,15.97 17.9,17.39M11,19.93C7.05,19.44 4,16.08 4,12C4,11.38 4.08,10.78 4.21,10.21L9,15V16A2,2 0 0,0 11,18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[a.title?e("title",[a._v(a._s(a.title))]):a._e()])])])},O=[],G=i(z,U,O,!1,null,null);const Z=G.exports,D="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20id='mdi-account-group'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M12,5.5A3.5,3.5%200%200,1%2015.5,9A3.5,3.5%200%200,1%2012,12.5A3.5,3.5%200%200,1%208.5,9A3.5,3.5%200%200,1%2012,5.5M5,8C5.56,8%206.08,8.15%206.53,8.42C6.38,9.85%206.8,11.27%207.66,12.38C7.16,13.34%206.16,14%205,14A3,3%200%200,1%202,11A3,3%200%200,1%205,8M19,8A3,3%200%200,1%2022,11A3,3%200%200,1%2019,14C17.84,14%2016.84,13.34%2016.34,12.38C17.2,11.27%2017.62,9.85%2017.47,8.42C17.92,8.15%2018.44,8%2019,8M5.5,18.25C5.5,16.18%208.41,14.5%2012,14.5C15.59,14.5%2018.5,16.18%2018.5,18.25V20H5.5V18.25M0,20V18.5C0,17.11%201.89,15.94%204.45,15.6C3.86,16.28%203.5,17.22%203.5,18.25V20H0M24,20H20.5V18.25C20.5,17.22%2020.14,16.28%2019.55,15.6C22.11,15.94%2024,17.11%2024,18.5V20Z'%20/%3e%3c/svg%3e",j={name:"CollaboratorsSelectionForm",components:{Close:S,AccountGroup:N,ContentCopy:Y,Check:$,Earth:Z,NcButton:u,NcListItemIcon:m,NcSelect:p},mixins:[L],props:{albumName:{type:String,required:!0},collaborators:{type:Array,default:()=>[]},allowPublicLink:{type:Boolean,default:!0}},data(){return{searchText:null,availableCollaborators:{},selectedCollaboratorsKeys:[],currentSearchResults:[],loadingCollaborators:!1,randomId:Math.random().toString().substring(2,10),publicLinkCopied:!1,collaboratorTypes:o,config:{minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0}}},computed:{searchResults(){return this.currentSearchResults.filter(({id:a})=>a!==k().uid).map(a=>({...a,key:`${a.type}:${a.id}`,iconSvg:a.type===o.SHARE_TYPE_GROUP?D:void 0})).filter(({key:a})=>!this.selectedCollaboratorsKeys.includes(a))},listableSelectedCollaboratorsKeys(){return this.selectedCollaboratorsKeys.filter(a=>this.availableCollaborators[a].type!==o.SHARE_TYPE_LINK)},selectedCollaborators(){return this.selectedCollaboratorsKeys.map(a=>this.availableCollaborators[a])},isPublicLinkSelected(){return this.selectedCollaboratorsKeys.includes(`${o.SHARE_TYPE_LINK}`)},publicLink(){return this.availableCollaborators[o.SHARE_TYPE_LINK]},publicLinkURL(){return`${window.location.protocol}//${window.location.host}${v(`apps/photos/public/${this.publicLink.id}`)}`},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},watch:{collaborators(a){this.populateCollaborators(a)}},mounted(){this.populateCollaborators(this.collaborators)},methods:{...c(["updateCollection"]),async searchCollaborators(a){if(a!==void 0&&(a=a.trim(),!(a.length<this.config.minSearchStringLength)))try{this.loadingCollaborators=!0;const e=await d.get(g("core/autocomplete/get"),{params:{search:a,itemType:"share-recipients",shareTypes:[o.SHARE_TYPE_USER,o.SHARE_TYPE_GROUP]}});this.currentSearchResults=e.data.ocs.data.map(l=>{switch(l.source){case"users":return{id:l.id,label:l.label,type:o.SHARE_TYPE_USER};case"groups":return{id:l.id,label:l.label,type:o.SHARE_TYPE_GROUP};default:throw new Error(`Invalid collaborator source ${l.source}`)}}),this.availableCollaborators={...this.availableCollaborators,...this.currentSearchResults.reduce(this.indexCollaborators,{})}}catch(e){this.errorFetchingCollaborators=e,r.error(t("photos","Failed to fetch collaborators list."),e),n(t("photos","Failed to fetch collaborators list."))}finally{this.loadingCollaborators=!1}},populateCollaborators(a){const e=a.reduce(this.indexCollaborators,{});this.selectedCollaboratorsKeys=Object.keys(e),this.availableCollaborators={3:{id:"",label:t("photos","Public link"),type:o.SHARE_TYPE_LINK},...this.availableCollaborators,...e}},indexCollaborators(a,e){return{...a,[`${e.type}${e.type===o.SHARE_TYPE_LINK?"":":"}${e.type===o.SHARE_TYPE_LINK?"":e.id}`]:e}},async createPublicLinkForAlbum(){this.selectEntity(`${o.SHARE_TYPE_LINK}`),await this.updateAlbumCollaborators(),await this.fetchCollection(this.albumFileName,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},async deletePublicLink(){this.unselectEntity(`${o.SHARE_TYPE_LINK}`),this.availableCollaborators[3]={id:"",label:t("photos","Public link"),type:o.SHARE_TYPE_LINK},this.publicLinkCopied=!1,await this.updateAlbumCollaborators()},async updateAlbumCollaborators(){try{await this.updateCollection({collectionFileName:this.albumFileName,properties:{collaborators:this.selectedCollaborators}})}catch(a){r.error("[PublicAlbumContent] Error updating album",{error:a}),n(this.t("photos","Failed to update album."))}},async copyPublicLink(){await navigator.clipboard.writeText(this.publicLinkURL),this.publicLinkCopied=!0,setTimeout(()=>{this.publicLinkCopied=!1},1e4)},selectEntity(a){this.searchText=null,!this.selectedCollaboratorsKeys.includes(a)&&this.selectedCollaboratorsKeys.push(a)},unselectEntity(a){const e=this.selectedCollaboratorsKeys.indexOf(a);e!==-1&&this.selectedCollaboratorsKeys.splice(e,1)},t:b}};var q=function(){var a=this,e=a._self._c;return e("div",{staticClass:"manage-collaborators"},[e("h2",{staticClass:"manage-collaborators__title"},[a._v(" "+a._s(a.t("photos","Add collaborators"))+" ")]),e("form",{staticClass:"manage-collaborators__form",on:{submit:function(l){l.preventDefault()}}},[e("NcSelect",{attrs:{"input-id":"sharing-search-input","input-label":a.t("photos","Add people or groups who can edit your album"),loading:a.loadingCollaborators,label:"label",filterable:!1,placeholder:a.t("photos","Search people or groups"),"clear-search-on-blur":()=>!1,"user-select":!0,"append-to-body":!1,options:a.searchResults},on:{search:a.searchCollaborators,"option:selected":({key:l})=>a.selectEntity(l)},model:{value:a.searchText,callback:function(l){a.searchText=l},expression:"searchText"}},[a._v(" "+a._s(a.t("photos","No recommendations. Start typing."))+" ")])],1),e("ul",{staticClass:"manage-collaborators__selection"},a._l(a.listableSelectedCollaboratorsKeys,function(l){return e("li",{key:l,staticClass:"manage-collaborators__selection__item"},[e("NcListItemIcon",{attrs:{id:a.availableCollaborators[l].id,"display-name":a.availableCollaborators[l].label,name:a.availableCollaborators[l].label,user:a.availableCollaborators[l].id,"is-no-user":a.availableCollaborators[l].type!==a.collaboratorTypes.SHARE_TYPE_USER}},[a.availableCollaborators[l].type===a.collaboratorTypes.SHARE_TYPE_GROUP?e("AccountGroup",{attrs:{title:a.t("photos","Group")}}):a._e(),e("NcButton",{attrs:{type:"tertiary","aria-label":a.t("photos","Remove {collaboratorLabel} from the collaborators list",{collaboratorLabel:a.availableCollaborators[l].label})},on:{click:function(s){return a.unselectEntity(l)}}},[e("Close",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)],1)}),0),e("div",{staticClass:"actions"},[a.allowPublicLink?e("div",{staticClass:"actions__public-link"},[a.isPublicLinkSelected&&a.publicLink.id!==""?[e("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{"aria-label":a.t("photos","Copy the public link"),title:a.publicLinkURL},on:{click:a.copyPublicLink},scopedSlots:a._u([{key:"icon",fn:function(){return[a.publicLinkCopied?e("Check"):e("ContentCopy")]},proxy:!0}],null,!1,845538853)},[a.publicLinkCopied?[a._v(" "+a._s(a.t("photos","Public link copied!"))+" ")]:[a._v(" "+a._s(a.t("photos","Copy public link"))+" ")]],2),e("NcButton",{attrs:{type:"tertiary","aria-label":a.t("photos","Delete the public link")},on:{click:a.deletePublicLink}},[e("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:e("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{disabled:a.isPublicLinkSelected&&a.publicLink.id==="","aria-label":a.t("photos","Create public link share")},on:{click:a.createPublicLinkForAlbum}},[e("Earth",{attrs:{slot:"icon"},slot:"icon"}),a._v(" "+a._s(a.t("photos","Share via public link"))+" ")],1)],2):a._e(),e("div",{staticClass:"actions__slot"},[a._t("default",null,{collaborators:a.selectedCollaborators})],2)])])},Q=[],J=i(j,q,Q,!1,null,"e0508b86");const W=J.exports,X={name:"AlbumForm",components:{MapMarker:_,AccountMultiplePlus:x,Send:f,NcButton:u,NcLoadingIcon:C,NcTextField:h,CollaboratorsSelectionForm:W},props:{album:{type:Object,default:null},displayBackButton:{type:Boolean,default:!1}},data(){return{showCollaboratorView:!1,albumName:"",albumLocation:"",loading:!1}},computed:{editMode(){return this.album!==null},sharingEnabled(){return OC.Share!==void 0},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},mounted(){this.editMode&&(this.albumName=this.album.basename,this.albumLocation=this.album.location??""),this.$nextTick(()=>{this.$refs.nameInput.$el.getElementsByTagName("input")[0].focus()})},methods:{...c(["createCollection","renameCollection","updateCollection"]),submit(a=[]){this.albumName===""||this.loading||(this.editMode?this.handleUpdateAlbum():this.handleCreateAlbum(a))},async handleCreateAlbum(a=[]){try{this.loading=!0;let e=await this.createCollection({collection:{basename:this.albumName,filename:this.albumFileName,nbItems:0,location:this.albumLocation,lastPhoto:-1,date:y().format("MMMM YYYY"),collaborators:a,source:A(`dav/${this.albumFileName}`)}});if(e===void 0)return;(this.albumLocation!==""||a.length!==0)&&(e=await this.updateCollection({collectionFileName:this.albumFileName,properties:{location:this.albumLocation,collaborators:a}})),this.$emit("done",{album:e})}finally{this.loading=!1}},async handleUpdateAlbum(){try{this.loading=!0;let a={...this.album};this.album.basename!==this.albumName&&(a=await this.renameCollection({collectionFileName:this.album.filename,newBaseName:this.albumName})),this.album.location!==this.albumLocation&&(a=await this.updateCollection({collectionFileName:a.filename,properties:{location:this.albumLocation}})),this.$emit("done",{album:a})}finally{this.loading=!1}},back(){this.$emit("back")},t:b}};var tt=function(){var a=this,e=a._self._c;return a.showCollaboratorView?e("CollaboratorsSelectionForm",{attrs:{"album-name":a.albumName,"allow-public-link":!1},scopedSlots:a._u([{key:"default",fn:function({collaborators:l}){return[e("span",{staticClass:"left-buttons"},[e("NcButton",{attrs:{type:"tertiary"},on:{click:function(s){a.showCollaboratorView=!1}}},[a._v(" "+a._s(a.t("photos","Back"))+" ")])],1),e("span",{staticClass:"right-buttons"},[e("NcButton",{attrs:{type:"primary",disabled:a.albumName.trim()===""||a.loading},on:{click:function(s){return a.submit(l)}},scopedSlots:a._u([{key:"icon",fn:function(){return[a.loading?e("NcLoadingIcon",{attrs:{size:20}}):e("Send",{attrs:{size:20}})]},proxy:!0}],null,!0)},[a._v(" "+a._s(a.editMode?a.t("photos","Save"):a.t("photos","Create album"))+" ")])],1)]}}])}):e("form",{staticClass:"album-form",on:{submit:function(l){return l.preventDefault(),a.submit.apply(null,arguments)}}},[e("div",{staticClass:"form-inputs"},[e("NcTextField",{ref:"nameInput",attrs:{value:a.albumName,type:"text",name:"name",required:!0,label:a.t("photos","Name of the album")},on:{"update:value":function(l){a.albumName=l}}}),e("NcTextField",{attrs:{value:a.albumLocation,name:"location",type:"text",label:a.t("photos","Location of the album")},on:{"update:value":function(l){a.albumLocation=l}},scopedSlots:a._u([{key:"default",fn:function(){return[e("MapMarker",{attrs:{size:20}})]},proxy:!0}],null,!1,2964444886)})],1),e("div",{staticClass:"form-buttons"},[e("span",{staticClass:"left-buttons"},[a.displayBackButton?e("NcButton",{attrs:{type:"tertiary"},on:{click:a.back}},[a._v(" "+a._s(a.t("photos","Back"))+" ")]):a._e()],1),e("span",{staticClass:"right-buttons"},[a.sharingEnabled&&!a.editMode?e("NcButton",{attrs:{type:"secondary",disabled:a.albumName.trim()===""||a.loading},on:{click:function(l){a.showCollaboratorView=!0}},scopedSlots:a._u([{key:"icon",fn:function(){return[e("AccountMultiplePlus",{attrs:{size:20}})]},proxy:!0}],null,!1,3656768963)},[a._v(" "+a._s(a.t("photos","Add collaborators"))+" ")]):a._e(),e("NcButton",{attrs:{type:"primary",disabled:a.albumName===""||a.loading},on:{click:function(l){return a.submit()}},scopedSlots:a._u([{key:"icon",fn:function(){return[a.loading?e("NcLoadingIcon",{attrs:{size:20}}):e("Send",{attrs:{size:20}})]},proxy:!0}],null,!1,2302891232)},[a._v(" "+a._s(a.editMode?a.t("photos","Save"):a.t("photos","Create album"))+" ")])],1)])])},at=[],et=i(X,tt,at,!1,null,"6b58e552");const pt=et.exports;export{pt as A,W as C};
//# sourceMappingURL=AlbumForm-ZC3TTnim.chunk.mjs.map
