import{m as a,M as s,n}from"./icons-nZl_T3UH.chunk.mjs";import{B as r,K as o,D as m,L as i}from"./index-D_XdeNxG.chunk.mjs";import{t as c,_ as u,Q as h,a6 as b}from"./vue.runtime.esm-CWuAmtQL.chunk.mjs";import{N as p}from"./NcEmptyContent-TmfoGKLY.chunk.mjs";import{i as d}from"./isMobile-UC9rFypT.chunk.mjs";import{P as f}from"./PhotosFiltersDisplay-2V1kPYZJ.chunk.mjs";import{C}from"./CollectionContent-B7-sQPQ4.chunk.mjs";import{H as g}from"./HeaderNavigation-CjYjgySL.chunk.mjs";import{F}from"./FetchCollectionContentMixin-6WhAsZmn.chunk.mjs";import"./index-C-mleKoq.chunk.mjs";import"./collectionFetcher-MIJwDDfs.chunk.mjs";import"./index-TiNoniiy.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./FilesListViewer-CVr97Sjl.chunk.mjs";import"./fileFetcher-BB_j0YOh.chunk.mjs";import"./File-H70u8c-a.chunk.mjs";import"./AbortControllerMixin-CQgfjju6.chunk.mjs";const v={name:"PublicAlbumContent",components:{MapMarker:s,ImageOff:a,NcEmptyContent:p,NcActions:r,CollectionContent:C,HeaderNavigation:g,PhotosFiltersDisplay:f},mixins:[F,d],props:{token:{type:String,required:!0}},data(){return{showAddPhotosModal:!1,loadingCount:0,loadingAddFilesToAlbum:!1,albumOriginalName:"",publicClient:h(b("dav"),{Authorization:`Basic ${btoa(`${this.token}:`)}`})}},computed:{album(){return this.$store.getters.getPublicAlbum(this.albumName)},albumName(){return this.token},albumFileIds(){return this.$store.getters.getPublicAlbumFiles(this.albumName)},publicAlbumFileName(){return this.$store.getters.getPublicAlbumName(this.albumName)}},async beforeMount(){await this.fetchAlbumInfo(),await this.fetchAlbumContent()},methods:{async fetchAlbumInfo(){const t=await this.fetchCollection(`${o}/${this.token}`,i,this.publicClient);t!==null&&(this.albumOriginalName=t.attributes["original-name"])},async fetchAlbumContent(){(await this.fetchCollectionFiles(`${o}/${this.token}`,[...m,...i],this.publicClient)).forEach(t=>{t.update({previewUrl:u(`/apps/photos/api/v1/publicPreview/${t.fileid}?x=2048&y=2048&token=${this.token}`),hasPreview:!1})})},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.$store.dispatch("addFilesToCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.$store.dispatch("removeFilesFromCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToRemove:t})},t:c}};var N=function(){var t=this,e=t._self._c;return e("div",[e("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,"allow-selection":!1,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:l}){return t.albumOriginalName!==""?e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollection||t.loadingCollectionFiles,params:{token:t.token},path:"/","root-title":t.albumOriginalName,title:t.albumOriginalName},on:{refresh:t.fetchAlbumContent}},[t.album.attributes.location!==""?e("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[e("MapMarker"),t._v(t._s(t.album.attributes.location)+" ")],1):t._e(),e("template",{slot:"default"},[t.album!==void 0?e("span",{staticClass:"album-container__filters"},[e("PhotosFiltersDisplay",{attrs:{"filters-value":t.album.attributes.filters}})],1):t._e()]),t.album!==void 0?e("template",{slot:"right"},[e("NcActions",{attrs:{"force-menu":!0,"aria-label":t.t("photos","Open actions menu")}},[l.length>0?void 0:t._e()],2)],1):t._e()],2):t._e()}}],null,!0)},[e("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[e("ImageOff",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1)},A=[],y=n(v,N,A,!1,null,"e831f111");const q=y.exports;export{q as default};
//# sourceMappingURL=PublicAlbumContent-BAf1_LjR.chunk.mjs.map
