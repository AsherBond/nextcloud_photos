(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".tiled-row[data-v-36c907e2]{display:flex}.tiled-container[data-v-573bf53c]{height:100%}.tiled-container .tiled-row[data-v-573bf53c]{display:flex}.vs-container[data-v-ba4242f3]{overflow-y:scroll;height:100%}.vs-rows-container[data-v-ba4242f3]{box-sizing:border-box;will-change:scroll-position,padding;contain:layout paint style}.files-list-viewer[data-v-8203799d]{height:100%;position:relative}.files-list-viewer__placeholder[data-v-8203799d]{background:var(--color-primary-element-light);width:100%;height:100%;border:2px solid var(--color-main-background)}.files-list-viewer .tiled-container[data-v-8203799d]{flex-basis:0}.files-list-viewer ul[data-v-8203799d]{display:flex;flex-wrap:wrap}.files-list-viewer ul li[data-v-8203799d]:not(.last-tiled-rows){flex-grow:1}.files-list-viewer__section-header[data-v-8203799d]{position:sticky;top:0;z-index:3;background:var(--color-main-background)}.files-list-viewer__loader[data-v-8203799d]{margin:50px 0}")),document.head.appendChild(e)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
import{f as h,A as g,x as m,o as y}from"./index-CYNaqKNs.chunk.mjs";import{n as d}from"./index-Y-UlKA14.chunk.mjs";import{u as w,s as v}from"./vue.runtime.esm-Cvc35Ey2.chunk.mjs";import{N as b}from"./NcEmptyContent-D1s5wRoX.chunk.mjs";import{f as S}from"./fileFetcher-DueDmSo0.chunk.mjs";const ee={name:"FilesSelectionMixin",data(){return{selection:{}}},watch:{$route(){this.resetSelection()}},methods:{onFileSelectToggle({id:e,value:t}){this.$set(this.selection,e,t)},onUncheckFiles(e){e.forEach(t=>this.$set(this.selection,t,!1))},resetSelection(){this.selection={}}},computed:{selectedFileIds(){return Object.keys(this.selection).filter(e=>this.selection[e])}}},C={name:"PackageVariantIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var L=function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon package-variant-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M2,10.96C1.5,10.68 1.35,10.07 1.63,9.59L3.13,7C3.24,6.8 3.41,6.66 3.6,6.58L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.66,6.72 20.82,6.88 20.91,7.08L22.36,9.6C22.64,10.08 22.47,10.69 22,10.96L21,11.54V16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V10.96C2.7,11.13 2.32,11.14 2,10.96M12,4.15V4.15L12,10.85V10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V12.69L14,15.59C13.67,15.77 13.3,15.76 13,15.6V19.29L19,15.91M13.85,13.36L20.13,9.73L19.55,8.72L13.27,12.35L13.85,13.36Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])},_=[],H=d(C,L,_,!1,null,null);const k=H.exports;function T(e,t,i=200){if(t===0)return[];const o=[];let n=0,r=0;for(;r<e.length;){const l=[];do l.push(e[r++]);while(r<e.length&&z([...l,e[r]],i)<=t);const a=$(l,t,e.length===r,i);o[n]={items:l.map(c=>({...c,width:a*c.ratio,height:a})),height:a,key:l.map(c=>c.id).join("-")},n+=1}return o}function z(e,t){return e.map(i=>t*i.ratio).reduce((i,o)=>i+o)}function $(e,t,i,o){const n=e.map(l=>l.ratio).reduce((l,a)=>l+a);let r=t/n;return e.length===1&&e[0].width>t&&(r=t/e[0].ratio),i&&(r=Math.min(o+20,r)),r}const P={};var M=function(e,t){return e("ul",t._l(t.props.rows,function(i){return e("div",{key:i.key,staticClass:"tiled-row",style:{height:`${i.height}px`}},t._l(i.items,function(o){return e("li",{key:o.id,style:{width:o.ratio?`${i.height*o.ratio}px`:"100%",height:`${i.height}px`}},[t._t("default",null,{row:i,item:o})],2)}),0)}),0)},x=[],F=d(P,M,x,!0,null,"36c907e2");const V=F.exports,I={name:"TiledLayout",components:{TiledRows:V},props:{sections:{type:Array,required:!0},baseHeight:{type:Number,default:200}},data(){return{containerWidth:0,resizeObserver:null}},computed:{tiledSections(){return h.debug("[TiledLayout] Computing rows",{items:this.sections}),this.sections.map(e=>{const t=T(e.items,this.containerWidth,this.baseHeight);return{...e,key:e.id,rows:t.map(i=>({...i,sectionKey:e.id})),height:t.reduce((i,o)=>i+o.height,0)}})}},mounted(){this.resizeObserver=new ResizeObserver(e=>{for(const t of e){const i=t.contentRect;t.target.classList.contains("tiled-container")&&(this.containerWidth=i.width)}}),this.resizeObserver.observe(this.$refs.tiledLayoutContainer)},beforeDestroy(){this.resizeObserver?.disconnect()}};var E=function(){var e=this,t=e._self._c;return t("div",{ref:"tiledLayoutContainer",staticClass:"tiled-container"},[e._t("default",function(){return[t("TiledRows",{attrs:{rows:e.tiledSections}})]},{tiledSections:e.tiledSections})],2)},N=[],B=d(I,E,N,!1,null,"573bf53c");const O=B.exports,W={name:"VirtualScrolling",props:{sections:{type:Array,required:!0},containerElement:{type:HTMLElement,default:null},useWindow:{type:Boolean,default:!1},headerHeight:{type:Number,default:75},renderDistance:{type:Number,default:.5},bottomBufferRatio:{type:Number,default:2},scrollToKey:{type:String,default:""}},data(){return{scrollPosition:0,containerHeight:0,rowsContainerHeight:0,resizeObserver:null}},computed:{visibleSections(){h.debug("[VirtualScrolling] Computing visible section",{sections:this.sections});const e=this.containerHeight,t=this.scrollPosition,i=t+e;let o=0,n=0;const r=this.sections.map(s=>(n+=this.headerHeight,{...s,rows:s.rows.reduce((u,p)=>{o=n,n+=p.height;let f=0;return n<t?f=(t-n)/e:o>i&&(f=(o-i)/e),f>this.renderDistance?u:[...u,{...p,distance:f}]},[])})).filter(s=>s.rows.length>0),l=r.flatMap(({rows:s})=>s).flatMap(({items:s})=>s);l.forEach(s=>s.key=this.rowIdToKeyMap[s.id]);const a=l.map(({key:s})=>s).filter(s=>s!==void 0),c=Object.values(this.rowIdToKeyMap).filter(s=>!a.includes(s));return l.filter(({key:s})=>s===void 0).forEach(s=>s.key=c.pop()??Math.random().toString(36).substr(2)),this.rowIdToKeyMap=l.reduce((s,{id:u,key:p})=>({...s,[`${u}`]:p}),{}),r},totalHeight(){return this.sections.map(e=>this.headerHeight+e.height).reduce((e,t)=>e+t,0)+200},paddingTop(){if(this.visibleSections.length===0)return 0;let e=0;for(const t of this.sections){if(t.key!==this.visibleSections[0].rows[0].sectionKey){e+=this.headerHeight+t.height;continue}for(const i of t.rows){if(i.key===this.visibleSections[0].rows[0].key)return e;e+=i.height}e+=this.headerHeight}return e},rowsContainerStyle(){return{height:`${this.totalHeight}px`,paddingTop:`${this.paddingTop}px`}},isNearBottom(){const e=this.containerHeight*this.bottomBufferRatio;return this.scrollPosition+this.containerHeight>=this.totalHeight-e},container(){return h.debug("[VirtualScrolling] Computing container"),this.containerElement!==null?this.containerElement:this.useWindow?window:this.$refs.container}},watch:{isNearBottom(e){h.debug("[VirtualScrolling] isNearBottom changed",{value:e}),e&&this.$emit("need-content")},visibleSections(){this.isNearBottom&&this.$emit("need-content")},scrollToKey(e){let t=0;for(const i of this.sections){if(i.key!==e){t+=this.headerHeight+i.height;continue}break}h.debug("[VirtualScrolling] Scrolling to",{currentRowTopDistanceFromTop:t}),this.$refs.container.scrollTo({top:t,behavior:"smooth"})}},beforeCreate(){this.rowIdToKeyMap={}},mounted(){this.resizeObserver=new ResizeObserver(e=>{for(const t of e){const i=t.contentRect;t.target===this.container&&(this.containerHeight=i.height),t.target.classList.contains("vs-rows-container")&&(this.rowsContainerHeight=i.height)}}),this.useWindow?(window.addEventListener("resize",this.updateContainerSize,{passive:!0}),this.containerHeight=window.innerHeight):this.resizeObserver.observe(this.container),this.resizeObserver.observe(this.$refs.rowsContainer),this.container?.addEventListener("scroll",this.updateScrollPosition,{passive:!0})},beforeDestroy(){this.useWindow&&window.removeEventListener("resize",this.updateContainerSize),this.resizeObserver?.disconnect(),this.container?.removeEventListener("scroll",this.updateScrollPosition)},methods:{updateScrollPosition(){this._onScrollHandle??=requestAnimationFrame(()=>{this._onScrollHandle=null,this.useWindow?this.scrollPosition=this.container.scrollY:this.scrollPosition=this.container.scrollTop})},updateContainerSize(){this.containerHeight=window.innerHeight}}};var R=function(){var e=this,t=e._self._c;return!e.useWindow&&e.containerElement===null?t("div",{ref:"container",staticClass:"vs-container"},[t("div",{ref:"rowsContainer",staticClass:"vs-rows-container",style:e.rowsContainerStyle},[e._t("default",null,{visibleSections:e.visibleSections}),e._t("loader")],2)]):t("div",{ref:"rowsContainer",staticClass:"vs-rows-container",style:e.rowsContainerStyle},[e._t("default",null,{visibleSections:e.visibleSections}),e._t("loader")],2)},K=[],A=d(W,R,K,!1,null,"ba4242f3");const D=A.exports,j={name:"FilesListViewer",components:{PackageVariant:k,NcEmptyContent:b,NcLoadingIcon:y,TiledLayout:O,VirtualScrolling:D},props:{fileIds:{type:Array,default:void 0},fileIdsBySection:{type:Object,default:void 0},sections:{type:Array,default:void 0},loading:{type:Boolean,default:!1},emptyMessage:{type:String,default:""},baseHeight:{type:Number,default:200},sectionHeaderHeight:{type:Number,default:75},scrollToSection:{type:String,default:""},containerElement:{type:HTMLElement,default:null},useWindow:{type:Boolean,default:!1}},data(){return{placeholderFiles:Array(20).fill(0).map((e,t)=>{const i=this.croppedLayout?200:200*(1+Math.random()*2);return{id:t,width:i,height:200,ratio:i/200}})}},computed:{...m(["files"]),showPlaceholders(){return this.loading&&(this.fileIds?.length===0||this.sections?.length===0)},itemsBySections(){return this.fileIds!==void 0?this.showPlaceholders?[{id:"",items:this.placeholderFiles}]:[{id:"",items:this.fileIds.filter(e=>this.files[e]).map(this.mapFileToItem)}]:this.sections!==void 0?this.showPlaceholders?[{id:"placeholder",items:this.placeholderFiles}]:this.sections.map(e=>({id:e,items:this.fileIdsBySection[e].filter(t=>this.files[t]).map(this.mapFileToItem)})):[]},photosCount(){return this.itemsBySections.map(({items:e})=>e.length).reduce((e,t)=>e+t,0)},showLoader(){return this.loading&&(this.fileIds?.length!==0||this.sections?.length!==0)},croppedLayout(){return this.$store.state.userConfig.croppedLayout}},mounted(){v("files:node:updated",this.handleFileUpdated)},destroyed(){w("files:node:updated",this.handleFileUpdated)},methods:{...g(["appendFiles"]),needContent(){this.$emit("need-content")},mapFileToItem(e){const t=this.files[e];return{id:t.fileid,width:t.metadataPhotosSize.width,height:t.metadataPhotosSize.height,ratio:this.croppedLayout?1:t.metadataPhotosSize.width/t.metadataPhotosSize.height}},async handleFileUpdated({fileid:e}){const t=await S(this.files[e].filename);this.appendFiles([t])}}};var U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"files-list-viewer"},[e.emptyMessage!==""&&e.photosCount===0&&!e.loading?t("NcEmptyContent",{key:"emptycontent",attrs:{name:e.emptyMessage}},[t("PackageVariant",{attrs:{slot:"icon"},slot:"icon"})],1):e._e(),t("TiledLayout",{attrs:{"base-height":e.baseHeight,sections:e.itemsBySections},scopedSlots:e._u([{key:"default",fn:function({tiledSections:i}){return t("VirtualScrolling",{attrs:{"use-window":e.useWindow,"container-element":e.containerElement,sections:i,"scroll-to-key":e.scrollToSection,"header-height":e.sectionHeaderHeight},on:{"need-content":e.needContent},scopedSlots:e._u([{key:"default",fn:function({visibleSections:o}){return e._l(o,function(n){return t("div",{key:n.id},[n.id!==""?[e.showPlaceholders?t("div",{staticClass:"files-list-viewer__placeholder",style:{"flex-basis":"100%",height:`${e.sectionHeaderHeight}px`}}):e._t("default",null,{file:{id:n.id},isHeader:!0})]:e._e(),t("ul",[e._l(n.rows,function(r,l){return e._l(r.items,function(a){return t("li",{key:a.key,class:{"last-tiled-rows":l===n.rows.length-1},style:{"flex-basis":`${a.width-1}px`,height:`${a.height}px`}},[e.showPlaceholders?t("div",{staticClass:"files-list-viewer__placeholder"}):e._t("default",null,{file:a,distance:r.distance})],2)})})],2)],2)})}}])},[e.loading&&!e.showPlaceholders?t("NcLoadingIcon",{staticClass:"files-list-viewer__loader",attrs:{slot:"loader"},slot:"loader"}):e._e()],1)}}])})],1)},q=[],Y=d(j,U,q,!1,null,"8203799d");const te=Y.exports;export{ee as F,te as a};
//# sourceMappingURL=FilesListViewer-CuvsdS1s.chunk.mjs.map
