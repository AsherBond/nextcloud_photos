(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('.favorite-marker-icon[data-v-c10f82c2]{color:#a08b00;min-width:unset!important;min-height:unset!important}.favorite-marker-icon[data-v-c10f82c2] svg{width:32px!important;height:32px!important;max-width:unset!important;max-height:unset!important}.favorite-marker-icon[data-v-c10f82c2] svg path{stroke:var(--color-main-background);stroke-width:10px;stroke-linejoin:round;paint-order:stroke}.file-container[data-v-2c067e9d]{contain:strict;background:var(--color-primary-element-light);position:relative;height:100%;width:100%;border:2px solid var(--color-main-background);box-sizing:border-box}.file-container.selected[data-v-2c067e9d]:after,.file-container[data-v-2c067e9d]:focus-within:after,.file-container[data-v-2c067e9d]:has(:focus):after{position:absolute;top:0;left:0;z-index:2;width:100%;height:100%;content:"";outline:var(--color-primary-element) solid 4px;outline-offset:-4px;pointer-events:none}.file-container.selected .selection-checkbox[data-v-2c067e9d],.file-container:focus-within .selection-checkbox[data-v-2c067e9d],.file-container:has(:focus) .selection-checkbox[data-v-2c067e9d]{opacity:1}.file-container .file[data-v-2c067e9d]{width:100%;height:100%;box-sizing:border-box;outline:none;display:flex}.file-container .file__blurhash[data-v-2c067e9d]{position:absolute;top:0;height:100%;width:100%;object-fit:cover}.file-container .file__images[data-v-2c067e9d]{width:100%;height:100%}.file-container .file__images .icon-overlay[data-v-2c067e9d]{position:absolute;top:0;right:0;width:100%;height:100%;z-index:1;opacity:.8}.file-container .file__images .icon-overlay[data-v-2c067e9d] .material-design-icon__svg{fill:var(--color-main-background)}.file-container .file__images img[data-v-2c067e9d]{width:100%;height:100%;object-fit:cover;position:absolute;color:transparent}.file-container:hover .selection-checkbox[data-v-2c067e9d],.file-container.selected .selection-checkbox[data-v-2c067e9d],.file-container:focus-within .selection-checkbox[data-v-2c067e9d]{opacity:1}.file-container:hover .favorite-state[data-v-2c067e9d],.file-container.selected .favorite-state[data-v-2c067e9d],.file-container:focus-within .favorite-state[data-v-2c067e9d]{display:none}.file-container .selection-checkbox[data-v-2c067e9d]{opacity:0;position:absolute;top:8px;right:min(22px,50% - 7px);z-index:1;width:-moz-fit-content;width:fit-content}.file-container .selection-checkbox[data-v-2c067e9d] .checkbox-radio-switch__input:focus-visible+.checkbox-radio-switch__content,.file-container .selection-checkbox .checkbox-radio-switch__input[data-v-2c067e9d]:focus-visible{outline:2px solid var(--color-main-text);box-shadow:0 0 0 3px var(--color-main-background);outline-offset:0px}.file-container .selection-checkbox[data-v-2c067e9d] .checkbox-radio-switch__content{padding:10px;box-sizing:border-box;background:var(--color-main-background)}.file-container .selection-checkbox[data-v-2c067e9d] .checkbox-radio-switch__content:after{content:"";width:16px;height:16px;position:absolute;left:14px;z-index:-1}.file-container .selection-checkbox[data-v-2c067e9d] .checkbox-radio-switch__content .checkbox-radio-switch__icon{margin:0}.file-container .selection-checkbox .input-label[data-v-2c067e9d]{position:fixed;z-index:-1;top:-5000px;left:-5000px}.file-container .favorite-state[data-v-2c067e9d]{position:absolute;top:2px;right:min(2px,50% - 7px)}')),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
import{V as P}from"./Video-BPHakcg5.chunk.mjs";import{n as S}from"./index-BGGeUZyp.chunk.mjs";import{d as E,t as A,_ as x}from"./vue.runtime.esm-CShV2ddg.chunk.mjs";import{I as F,b as N}from"./index-C-nSEKko.chunk.mjs";var R=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],h=e=>{let a=0;for(let i=0;i<e.length;i++){let r=e[i],o=R.indexOf(r);a=a*83+o}return a},v=e=>{let a=e/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},L=e=>{let a=Math.max(0,Math.min(1,e));return a<=.0031308?Math.trunc(a*12.92*255+.5):Math.trunc((1.055*Math.pow(a,.4166666666666667)-.055)*255+.5)},T=e=>e<0?-1:1,b=(e,a)=>T(e)*Math.pow(Math.abs(e),a),k=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},q=e=>{if(!e||e.length<6)throw new k("The blurhash string must be at least 6 characters");let a=h(e[0]),i=Math.floor(a/9)+1,r=a%9+1;if(e.length!==4+2*r*i)throw new k(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*r*i}`)},D=e=>{let a=e>>16,i=e>>8&255,r=e&255;return[v(a),v(i),v(r)]},U=(e,a)=>{let i=Math.floor(e/361),r=Math.floor(e/19)%19,o=e%19;return[b((i-9)/9,2)*a,b((r-9)/9,2)*a,b((o-9)/9,2)*a]},O=(e,a,i,r)=>{q(e),r=r|1;let o=h(e[0]),y=Math.floor(o/9)+1,f=o%9+1,M=(h(e[1])+1)/166,d=new Array(f*y);for(let s=0;s<d.length;s++)if(s===0){let l=h(e.substring(2,6));d[s]=D(l)}else{let l=h(e.substring(4+s*2,6+s*2));d[s]=U(l,M*r)}let n=a*4,c=new Uint8ClampedArray(n*i);for(let s=0;s<i;s++)for(let l=0;l<a;l++){let _=0,$=0,C=0;for(let m=0;m<y;m++)for(let g=0;g<f;g++){let u=Math.cos(Math.PI*l*g/a)*Math.cos(Math.PI*s*m/i),p=d[g+m*f];_+=p[0]*u,$+=p[1]*u,C+=p[2]*u}let z=L(_),V=L($),B=L(C);c[4*l+0+s*n]=z,c[4*l+1+s*n]=V,c[4*l+2+s*n]=B,c[4*l+3+s*n]=255}return c},W=O;const Z={name:"PlayCircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var j=function(){var e=this,a=e._self._c;return a("span",e._b({staticClass:"material-design-icon play-circle-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[a("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M10,16.5V7.5L16,12M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[e.title?a("title",[e._v(e._s(e.title))]):e._e()])])])},G=[],H=S(Z,j,G,!1,null,null);const J=H.exports,K='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-star" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>',Q=E({name:"FavoriteIcon",components:{NcIconSvgWrapper:F},data(){return{StarSvg:K}},mounted(){this.$nextTick(()=>{this.$el.querySelector("svg")?.setAttribute?.("viewBox","-4 -4 30 30")})},methods:{t:A}});var X=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("NcIconSvgWrapper",{staticClass:"favorite-marker-icon",attrs:{name:e.t("photos","Favorite"),svg:e.StarSvg}})},Y=[],ee=S(Q,X,Y,!1,null,"c10f82c2");const te=ee.exports,ae="images",w=[],I=async function(e){try{if(!w[e]){const a=await(await window.caches?.open(ae))?.match(e);w[e]=a!==void 0}return w[e]}catch{return!1}},ie={name:"File",components:{FavoriteIcon:te,NcCheckboxRadioSwitch:N,VideoIcon:P,PlayCircleIcon:J},inheritAttrs:!1,props:{file:{type:Object,required:!0},selected:{type:Boolean,default:!1},allowSelection:{type:Boolean,default:!0},distance:{type:Number,default:0}},data(){return{initialized:!1,loadedSmall:!1,errorSmall:!1,loadedLarge:!1,errorLarge:!1}},computed:{ariaLabel(){return this.file.favorite?t("photos",'Favorite image, open the full size "{name}" image',{name:this.file.basename}):t("photos",'Open the full size "{name}" image',{name:this.file.basename})},isImage(){return this.file.mime.startsWith("image")},decodedEtag(){return this.file.etag.replace("&quot;","").replace("&quot;","")},srcLarge(){return this.getItemURL(512)},srcSmall(){return this.getItemURL(64)},isVisible(){return this.distance===0},hasBlurhash(){return this.file.metadataBlurhash!==void 0}},watch:{async file(){this.initialized=!1,this.loadedSmall=!1,this.errorSmall=!1,this.loadedLarge=!1,this.errorLarge=!1,await this.init()}},async mounted(){await this.init()},beforeDestroy(){this.$refs.imgSmall!==void 0&&(this.$refs.imgSmall.src=""),this.$refs.srcLarge!==void 0&&(this.$refs.srcLarge.src="")},methods:{async init(){[this.loadedSmall,this.loadedLarge]=await Promise.all([await I(this.srcSmall),await I(this.srcLarge)]),this.initialized=!0,await this.$nextTick(),this.drawBlurhash()},emitClick(){this.$emit("click",this.file.fileid)},onLoadSmall(){this.loadedSmall=!0},onLoadLarge(){this.loadedLarge=!0},onErrorSmall(){this.errorSmall=!0},onErrorLarge(){this.errorLarge=!0},onToggle(e){this.$emit("select-toggled",{id:this.file.fileid,value:e})},getItemURL(e){const a=this.$route?.params.token;return a?x(`/apps/photos/api/v1/publicPreview/${this.file.fileid}?etag=${this.decodedEtag}&x=${e}&y=${e}&token=${a}`):x(`/apps/photos/api/v1/preview/${this.file.fileid}?etag=${this.decodedEtag}&x=${e}&y=${e}`)},drawBlurhash(){if(!this.hasBlurhash||!this.$refs.canvas)return;const e=this.$refs.canvas.width,a=this.$refs.canvas.height,i=W(this.file.metadataBlurhash,e,a),r=this.$refs.canvas.getContext("2d"),o=r.createImageData(e,a);o.data.set(i),r.putImageData(o,0,0)}}};var re=function(){var e=this,a=e._self._c;return a("div",{staticClass:"file-container",class:{selected:e.selected},attrs:{"data-test":"media"}},[a("a",{staticClass:"file",attrs:{href:e.file.source,"aria-label":e.ariaLabel},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.emitClick.apply(null,arguments)}}},[a("div",{staticClass:"file__images"},[e.file.mime.includes("video")?a("VideoIcon",{staticClass:"icon-overlay",attrs:{size:64}}):e.file.metadataFilesLivePhoto!==void 0?a("PlayCircleIcon",{staticClass:"icon-overlay",attrs:{size:64}}):e._e(),e.initialized?[e.hasBlurhash&&!e.loadedSmall&&!e.loadedLarge?a("canvas",{ref:"canvas",staticClass:"file__blurhash",attrs:{"aria-hidden":"true"}}):e._e(),!e.loadedLarge&&(e.loadedSmall||e.distance<5&&!e.errorSmall)?a("img",{key:`${e.file.basename}-small`,ref:"imgSmall",attrs:{src:e.srcSmall,alt:e.file.basename,decoding:e.loadedSmall||e.isVisible?"sync":"async",fetchpriority:e.loadedSmall||e.isVisible?"high":"low",loading:e.loadedSmall||e.isVisible?"eager":e.distance<2?"auto":"lazy"},on:{load:e.onLoadSmall,error:e.onErrorSmall}}):e._e(),e.loadedLarge||(e.isVisible||e.distance<2&&(e.loadedSmall||e.errorSmall))&&!e.errorLarge?a("img",{key:`${e.file.basename}-large`,ref:"imgLarge",attrs:{src:e.srcLarge,alt:e.file.basename,decoding:e.loadedLarge||e.isVisible?"sync":"async",fetchpriority:e.loadedLarge||e.isVisible?"high":"low",loading:e.loadedLarge||e.isVisible?"auto":"lazy"},on:{load:e.onLoadLarge,error:e.onErrorLarge}}):e._e()]:e._e()],2)]),e.allowSelection?a("NcCheckboxRadioSwitch",{staticClass:"selection-checkbox",attrs:{"aria-label":e.t("photos","Select image {imageName}",{imageName:e.file.basename}),checked:e.selected},on:{"update:checked":e.onToggle}}):e._e(),e.file.favorite===1?e._m(0):e._e()],1)},se=[function(){var e=this,a=e._self._c;return a("FavoriteIcon",{staticClass:"favorite-state"})}],le=S(ie,re,se,!1,null,"2c067e9d");const de=le.exports;export{de as F};
//# sourceMappingURL=File-Bj3FpHMy.chunk.mjs.map
