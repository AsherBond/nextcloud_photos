import{n as M,B as E,V as P}from"./icons-CCMXs15V.chunk.mjs";import{d as F,t as N,_ as x}from"./vue.runtime.esm-K-L1yEsQ.chunk.mjs";import{I as R,b as T}from"./index-C1IyPqGx.chunk.mjs";var q=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],c=e=>{let a=0;for(let i=0;i<e.length;i++){let r=e[i],o=q.indexOf(r);a=a*83+o}return a},v=e=>{let a=e/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},L=e=>{let a=Math.max(0,Math.min(1,e));return a<=.0031308?Math.trunc(a*12.92*255+.5):Math.trunc((1.055*Math.pow(a,.4166666666666667)-.055)*255+.5)},A=e=>e<0?-1:1,b=(e,a)=>A(e)*Math.pow(Math.abs(e),a),I=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},D=e=>{if(!e||e.length<6)throw new I("The blurhash string must be at least 6 characters");let a=c(e[0]),i=Math.floor(a/9)+1,r=a%9+1;if(e.length!==4+2*r*i)throw new I(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*r*i}`)},U=e=>{let a=e>>16,i=e>>8&255,r=e&255;return[v(a),v(i),v(r)]},O=(e,a)=>{let i=Math.floor(e/361),r=Math.floor(e/19)%19,o=e%19;return[b((i-9)/9,2)*a,b((r-9)/9,2)*a,b((o-9)/9,2)*a]},W=(e,a,i,r)=>{D(e),r=r|1;let o=c(e[0]),S=Math.floor(o/9)+1,f=o%9+1,k=(c(e[1])+1)/166,d=new Array(f*S);for(let s=0;s<d.length;s++)if(s===0){let l=c(e.substring(2,6));d[s]=U(l)}else{let l=c(e.substring(4+s*2,6+s*2));d[s]=O(l,k*r)}let n=a*4,h=new Uint8ClampedArray(n*i);for(let s=0;s<i;s++)for(let l=0;l<a;l++){let y=0,$=0,_=0;for(let m=0;m<S;m++)for(let g=0;g<f;g++){let u=Math.cos(Math.PI*l*g/a)*Math.cos(Math.PI*s*m/i),p=d[g+m*f];y+=p[0]*u,$+=p[1]*u,_+=p[2]*u}let B=L(y),V=L($),z=L(_);h[4*l+0+s*n]=B,h[4*l+1+s*n]=V,h[4*l+2+s*n]=z,h[4*l+3+s*n]=255}return h},j=W;const Z='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-star" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>',G=F({name:"FavoriteIcon",components:{NcIconSvgWrapper:R},data(){return{StarSvg:Z}},mounted(){this.$nextTick(()=>{this.$el.querySelector("svg")?.setAttribute?.("viewBox","-4 -4 30 30")})},methods:{t:N}});var H=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("NcIconSvgWrapper",{staticClass:"favorite-marker-icon",attrs:{name:e.t("photos","Favorite"),svg:e.StarSvg}})},J=[],K=M(G,H,J,!1,null,"9131c562");const Q=K.exports,X="images",w=[],C=async function(e){try{if(!w[e]){const a=await(await window.caches?.open(X))?.match(e);w[e]=a!==void 0}return w[e]}catch{return!1}},Y={name:"File",components:{FavoriteIcon:Q,NcCheckboxRadioSwitch:T,VideoIcon:P,PlayCircleIcon:E},inheritAttrs:!1,props:{file:{type:Object,required:!0},selected:{type:Boolean,default:!1},allowSelection:{type:Boolean,default:!0},distance:{type:Number,default:0}},data(){return{initialized:!1,loadedSmall:!1,errorSmall:!1,loadedLarge:!1,errorLarge:!1}},computed:{ariaLabel(){return this.file.favorite?t("photos",'Favorite image, open the full size "{name}" image',{name:this.file.basename}):t("photos",'Open the full size "{name}" image',{name:this.file.basename})},isImage(){return this.file.mime.startsWith("image")},decodedEtag(){return this.file.etag.replace("&quot;","").replace("&quot;","")},srcLarge(){return this.getItemURL(512)},srcSmall(){return this.getItemURL(64)},isVisible(){return this.distance===0},hasBlurhash(){return this.file.metadataBlurhash!==void 0}},watch:{async file(){this.initialized=!1,this.loadedSmall=!1,this.errorSmall=!1,this.loadedLarge=!1,this.errorLarge=!1,await this.init()}},async mounted(){await this.init()},beforeDestroy(){this.$refs.imgSmall!==void 0&&(this.$refs.imgSmall.src=""),this.$refs.srcLarge!==void 0&&(this.$refs.srcLarge.src="")},methods:{async init(){[this.loadedSmall,this.loadedLarge]=await Promise.all([await C(this.srcSmall),await C(this.srcLarge)]),this.initialized=!0,await this.$nextTick(),this.drawBlurhash()},emitClick(){this.$emit("click",this.file.fileid)},onLoadSmall(){this.loadedSmall=!0},onLoadLarge(){this.loadedLarge=!0},onErrorSmall(){this.errorSmall=!0},onErrorLarge(){this.errorLarge=!0},onToggle(e){this.$emit("select-toggled",{id:this.file.fileid,value:e})},getItemURL(e){const a=this.$route?.params.token;return a?x(`/apps/photos/api/v1/publicPreview/${this.file.fileid}?etag=${this.decodedEtag}&x=${e}&y=${e}&token=${a}`):x(`/apps/photos/api/v1/preview/${this.file.fileid}?etag=${this.decodedEtag}&x=${e}&y=${e}`)},drawBlurhash(){if(!this.hasBlurhash||!this.$refs.canvas)return;const e=this.$refs.canvas.width,a=this.$refs.canvas.height,i=j(this.file.metadataBlurhash,e,a),r=this.$refs.canvas.getContext("2d"),o=r.createImageData(e,a);o.data.set(i),r.putImageData(o,0,0)}}};var ee=function(){var e=this,a=e._self._c;return a("div",{staticClass:"file-container",class:{selected:e.selected},attrs:{"data-test":"media"}},[a("a",{staticClass:"file",attrs:{href:e.file.source,"aria-label":e.ariaLabel},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.emitClick.apply(null,arguments)}}},[a("div",{staticClass:"file__images"},[e.file.mime.includes("video")?a("VideoIcon",{staticClass:"icon-overlay",attrs:{size:64}}):e.file.metadataFilesLivePhoto!==void 0?a("PlayCircleIcon",{staticClass:"icon-overlay",attrs:{size:64}}):e._e(),e.initialized?[e.hasBlurhash&&!e.loadedSmall&&!e.loadedLarge?a("canvas",{ref:"canvas",staticClass:"file__blurhash",attrs:{"aria-hidden":"true"}}):e._e(),!e.loadedLarge&&(e.loadedSmall||e.distance<5&&!e.errorSmall)?a("img",{key:`${e.file.basename}-small`,ref:"imgSmall",attrs:{src:e.srcSmall,alt:e.file.basename,decoding:e.loadedSmall||e.isVisible?"sync":"async",fetchpriority:e.loadedSmall||e.isVisible?"high":"low",loading:e.loadedSmall||e.isVisible?"eager":e.distance<2?"auto":"lazy"},on:{load:e.onLoadSmall,error:e.onErrorSmall}}):e._e(),e.loadedLarge||(e.isVisible||e.distance<2&&(e.loadedSmall||e.errorSmall))&&!e.errorLarge?a("img",{key:`${e.file.basename}-large`,ref:"imgLarge",attrs:{src:e.srcLarge,alt:e.file.basename,decoding:e.loadedLarge||e.isVisible?"sync":"async",fetchpriority:e.loadedLarge||e.isVisible?"high":"low",loading:e.loadedLarge||e.isVisible?"auto":"lazy"},on:{load:e.onLoadLarge,error:e.onErrorLarge}}):e._e()]:e._e()],2)]),e.allowSelection?a("NcCheckboxRadioSwitch",{staticClass:"selection-checkbox",attrs:{"aria-label":e.t("photos","Select image {imageName}",{imageName:e.file.basename}),checked:e.selected},on:{"update:checked":e.onToggle}}):e._e(),e.file.favorite===1?e._m(0):e._e()],1)},te=[function(){var e=this,a=e._self._c;return a("FavoriteIcon",{staticClass:"favorite-state"})}],ae=M(Y,ee,te,!1,null,"49207ea2");const le=ae.exports;export{le as F};
//# sourceMappingURL=File-BjGf26-P.chunk.mjs.map
