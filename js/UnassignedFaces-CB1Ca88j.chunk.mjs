import{A as a,x as n,B as l,D as c,C as r,o as d,f as s}from"./index-B_-Mz_Iy.chunk.mjs";import{x as f,m as h,k as p,p as u,S as F,n as m}from"./icons-CCMXs15V.chunk.mjs";import{V as v}from"./vue.runtime.esm-K-L1yEsQ.chunk.mjs";import{N as g}from"./NcEmptyContent-B2W4lHs9.chunk.mjs";import{F as _}from"./FetchFilesMixin-D47QgB7Y.chunk.mjs";import{F as w,a as C}from"./FilesListViewer-Ln2nMgD9.chunk.mjs";import{F as y}from"./File-C8oue46O.chunk.mjs";import{F as M}from"./FaceCover-X907lfcY.chunk.mjs";import{F as S}from"./FaceMergeForm-BfBPDMmr.chunk.mjs";import"./index-D-GU54Qs.chunk.mjs";import"./PhotoSearch-DJNn8r1v.chunk.mjs";import"./AbortControllerMixin-DeafVJKx.chunk.mjs";import"./fileFetcher-CU2g9brp.chunk.mjs";const k={name:"UnassignedFaces",components:{Star:F,Download:u,AlertCircle:p,ArrowLeft:h,FaceMergeForm:S,FilesListViewer:C,File:y,NcLoadingIcon:d,NcEmptyContent:g,NcActions:r,NcActionButton:c,NcDialog:l,AccountSwitch:f},directives:{focus(e){v.nextTick(()=>e.focus())}},mixins:[M,_,w],data(){return{showMoveModal:!1,loadingCount:0,appContent:document.getElementById("app-content-vue")}},computed:{...n(["files","unassignedFiles"]),faceFileIds(){return this.unassignedFiles||[]},shouldFavoriteSelection(){return this.selectedFileIds.some(e=>this.$store.state.files.files[e].favorite===0)}},mounted(){this.fetchUnassignedFaces()},methods:{...a(["appendFiles","deleteFace","renameFace","downloadFiles","toggleFavoriteForFiles","removeFilesFromFace","moveFilesToFace"]),openViewer(e){const o=this.files[e];OCA.Viewer.open({path:"/"+o.filename.split("/").slice(3).join("/"),list:this.faceFileIds.map(t=>({...this.files[t],filename:"/"+this.files[t].filename.split("/").slice(3).join("/")})),loadMore:o.loadMore?async()=>await o.loadMore(!0):()=>[],canLoop:o.canLoop})},async handleMove(e,o){try{this.loadingCount++,await this.moveFilesToFace({oldFace:null,faceName:e,fileIdsToMove:o}),this.showMoveModal=!1}catch(t){s.error(t)}finally{this.loadingCount--}},async favoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!0})}catch(e){s.error(e)}finally{this.loadingCount--}},async unFavoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!1})}catch(e){s.error(e)}finally{this.loadingCount--}},async downloadSelection(){try{this.loadingCount++,await this.downloadFiles(this.selectedFileIds)}catch(e){s.error(e)}finally{this.loadingCount--}}}};var A=function(){var e=this,o=e._self._c;return e.errorFetchingFiles?o("NcEmptyContent",{scopedSlots:e._u([{key:"icon",fn:function(){return[o("AlertCircle")]},proxy:!0}],null,!1,794036927)},[e._v(" "+e._s(e.t("photos","An error occurred"))+" ")]):o("div",{staticClass:"face"},[o("div",{staticClass:"face__header"},[o("div",{staticClass:"face__header__left"},[o("NcActions",[o("NcActionButton",{on:{click:function(t){return e.$router.push("/faces/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[o("ArrowLeft")]},proxy:!0}])},[e._v(e._s(e.t("photos","Back"))+" ")])],1),o("div",{staticClass:"face__header__title"},[o("h2",{class:{"face-name":!0}},[e._v(" "+e._s(e.t("photos","Unassigned faces"))+" ")])]),e.loadingCount>0||e.loadingFaces?o("NcLoadingIcon"):e._e()],1),o("div",{staticClass:"face__header__actions"},[o("NcActions",{attrs:{"force-menu":!0}},[e.selectedFileIds.length?[o("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Download selected files")},on:{click:e.downloadSelection}},[o("Download",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Download selected photos"))+" ")],1),e.shouldFavoriteSelection?o("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Mark selection as favorite")},on:{click:e.favoriteSelection}},[o("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Favorite"))+" ")],1):o("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Remove selection from favorites")},on:{click:e.unFavoriteSelection}},[o("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Remove from favorites"))+" ")],1),o("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(t){e.showMoveModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[o("AccountSwitch")]},proxy:!0}],null,!1,2937983280)},[e._v(" "+e._s(e.n("photos","Move photo to a different person","Move photos to a different person",e.selectedFileIds.length))+" ")])]:e._e()],2)],1)]),o("FilesListViewer",{staticClass:"face__photos",attrs:{"container-element":e.appContent,"file-ids":e.faceFileIds,loading:e.loadingFiles||e.loadingFaces},scopedSlots:e._u([{key:"default",fn:function({file:t,distance:i}){return o("File",{attrs:{file:e.files[t.id],"allow-selection":!0,selected:e.selection[t.id]===!0,distance:i},on:{click:e.openViewer,"select-toggled":e.onFileSelectToggle}})}}])}),e.showMoveModal?o("NcDialog",{attrs:{name:e.t("photos","Move to different person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(t){e.showMoveModal=!1}}},[o("FaceMergeForm",{attrs:{"first-face":"-1"},on:{select:function(t){return e.handleMove(t,e.selectedFileIds)}}})],1):e._e()],1)},N=[],I=m(k,A,N,!1,null,"af5ee551");const O=I.exports;export{O as default};
//# sourceMappingURL=UnassignedFaces-CB1Ca88j.chunk.mjs.map
