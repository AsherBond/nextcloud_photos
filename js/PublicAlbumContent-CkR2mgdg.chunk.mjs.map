{"version":3,"file":"PublicAlbumContent-CkR2mgdg.chunk.mjs","sources":["../node_modules/vue-material-design-icons/ImageOff.vue","../src/views/PublicAlbumContent.vue"],"sourcesContent":["<template>\n  <span v-bind=\"$attrs\"\n        :aria-hidden=\"title ? null : 'true'\"\n        :aria-label=\"title\"\n        class=\"material-design-icon image-off-icon\"\n        role=\"img\"\n        @click=\"$emit('click', $event)\">\n    <svg :fill=\"fillColor\"\n         class=\"material-design-icon__svg\"\n         :width=\"size\"\n         :height=\"size\"\n         viewBox=\"0 0 24 24\">\n      <path d=\"M21 17.2L6.8 3H19C20.1 3 21 3.9 21 5V17.2M20.7 22L19.7 21H5C3.9 21 3 20.1 3 19V4.3L2 3.3L3.3 2L22 20.7L20.7 22M16.8 18L12.9 14.1L11 16.5L8.5 13.5L5 18H16.8Z\">\n        <title v-if=\"title\">{{ title }}</title>\n      </path>\n    </svg>\n  </span>\n</template>\n\n<script>\nexport default {\n  name: \"ImageOffIcon\",\n  emits: ['click'],\n  props: {\n    title: {\n      type: String,\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n}\n</script>","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div>\n\t\t<CollectionContent ref=\"collectionContent\"\n\t\t\t:collection=\"album\"\n\t\t\t:collection-file-ids=\"albumFileIds\"\n\t\t\t:allow-selection=\"false\"\n\t\t\t:loading=\"loadingCollection || loadingCollectionFiles\"\n\t\t\t:error=\"errorFetchingCollection || errorFetchingCollectionFiles\">\n\t\t\t<!-- Header -->\n\t\t\t<HeaderNavigation v-if=\"albumOriginalName !== ''\"\n\t\t\t\tkey=\"navigation\"\n\t\t\t\tslot=\"header\"\n\t\t\t\tslot-scope=\"{selectedFileIds}\"\n\t\t\t\t:loading=\"loadingCollection || loadingCollectionFiles\"\n\t\t\t\t:params=\"{ token }\"\n\t\t\t\tpath=\"/\"\n\t\t\t\t:root-title=\"albumOriginalName\"\n\t\t\t\t:title=\"albumOriginalName\"\n\t\t\t\t@refresh=\"fetchAlbumContent\">\n\t\t\t\t<div v-if=\"album.location !== ''\" slot=\"subtitle\" class=\"album__location\">\n\t\t\t\t\t<MapMarker />{{ album.location }}\n\t\t\t\t</div>\n\t\t\t\t<template v-if=\"album !== undefined\" slot=\"right\">\n\t\t\t\t\t<NcActions :force-menu=\"true\" :aria-label=\"t('photos', 'Open actions menu')\">\n\t\t\t\t\t\t<!-- TODO: enable download on public albums -->\n\t\t\t\t\t\t<!-- <ActionDownload v-if=\"albumFileIds.length > 0\"\n\t\t\t\t\t\t\t:selected-file-ids=\"albumFileIds\"\n\t\t\t\t\t\t\t:title=\"t('photos', 'Download all files in album')\">\n\t\t\t\t\t\t\t<DownloadMultiple slot=\"icon\" />\n\t\t\t\t\t\t</ActionDownload> -->\n\n\t\t\t\t\t\t<template v-if=\"selectedFileIds.length > 0\">\n\t\t\t\t\t\t\t<!-- TODO: enable download on public albums -->\n\t\t\t\t\t\t\t<!-- <NcActionSeparator />\n\n\t\t\t\t\t\t\t<ActionDownload :selected-file-ids=\"selectedFileIds\" :title=\"t('photos', 'Download selected files')\">\n\t\t\t\t\t\t\t\t<Download slot=\"icon\" />\n\t\t\t\t\t\t\t</ActionDownload> -->\n\n\t\t\t\t\t\t\t<!-- </**  :close */-after-click=\"true\"\n\t\t\t\t\t\t\t\t@click=\"handleRemoveFilesFromAlbum(selectedFileIds)\">\n\t\t\t\t\t\t\t\t{{ t('photos', 'Remove selection from album') }}\n\t\t\t\t\t\t\t\t<Close slot=\"icon\" />\n\t\t\t\t\t\t\t<//** > */ -->\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcActions>\n\t\t\t\t</template>\n\t\t\t</HeaderNavigation>\n\n\t\t\t<!-- No content -->\n\t\t\t<NcEmptyContent slot=\"empty-content\"\n\t\t\t\t:name=\"t('photos', 'This album does not have any photos or videos yet!')\"\n\t\t\t\tclass=\"album__empty\">\n\t\t\t\t<ImageOff slot=\"icon\" />\n\n\t\t\t\t<!-- Public upload is not implemented yet\n\t\t\t\t<NcButton slot=\"action\"\n\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t:aria-label=\"t('photos', 'Add photos to this album')\"\n\t\t\t\t\t@click=\"showAddPhotosModal = true\">\n\t\t\t\t\t<Plus slot=\"icon\" />\n\t\t\t\t\t{{ t('photos', \"Add\") }}\n\t\t\t\t</NcButton>\n\t\t\t\t-->\n\t\t\t</NcEmptyContent>\n\t\t</CollectionContent>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport { mapActions } from 'vuex'\n\nimport MapMarker from 'vue-material-design-icons/MapMarker.vue'\n// import Plus from 'vue-material-design-icons/Plus.vue'\n// import ImagePlus from 'vue-material-design-icons/ImagePlus.vue'\nimport ImageOff from 'vue-material-design-icons/ImageOff.vue'\n// import Download from 'vue-material-design-icons/Download.vue'\n// import DownloadMultiple from 'vue-material-design-icons/DownloadMultiple.vue'\n\nimport { NcActions, /** NcButton, */ NcEmptyContent, /** NcActionSeparator, */ isMobile } from '@nextcloud/vue'\nimport { generateRemoteUrl, generateUrl } from '@nextcloud/router'\nimport { translate } from '@nextcloud/l10n'\n\nimport CollectionContent from '../components/Collection/CollectionContent.vue'\nimport HeaderNavigation from '../components/HeaderNavigation.vue'\n// import ActionDownload from '../components/Actions/ActionDownload.vue'\nimport FetchCollectionContentMixin from '../mixins/FetchCollectionContentMixin.js'\nimport { getClient } from '@nextcloud/files/dav'\nimport type { PublicAlbum } from '../store/publicAlbums.js'\n\nexport default {\n\tname: 'PublicAlbumContent',\n\tcomponents: {\n\t\tMapMarker,\n\t\t// Plus,\n\t\t// Download,\n\t\t// DownloadMultiple,\n\t\t// ImagePlus,\n\t\tImageOff,\n\t\tNcEmptyContent,\n\t\tNcActions,\n\t\t// NcActionSeparator,\n\t\t// NcButton,\n\t\tCollectionContent,\n\t\t// ActionDownload,\n\t\tHeaderNavigation,\n\t},\n\n\tmixins: [\n\t\tFetchCollectionContentMixin,\n\t\tisMobile,\n\t],\n\n\tprops: {\n\t\ttoken: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tshowAddPhotosModal: false,\n\t\t\tloadingCount: 0,\n\t\t\tloadingAddFilesToAlbum: false,\n\t\t\talbumOriginalName: '',\n\t\t\tpublicClient: getClient(generateRemoteUrl('dav'), {\n\t\t\t\tAuthorization: `Basic ${btoa(`${this.token}:`)}`,\n\t\t\t}),\n\t\t}\n\t},\n\n\tcomputed: {\n\t\talbum(): PublicAlbum {\n\t\t\treturn this.$store.getters.getPublicAlbum(this.albumName)\n\t\t},\n\n\t\talbumName(): string {\n\t\t\treturn this.token\n\t\t},\n\n\t\talbumFileIds(): string[] {\n\t\t\treturn this.$store.getters.getPublicAlbumFiles(this.albumName)\n\t\t},\n\n\t\tpublicAlbumFileName(): string {\n\t\t\treturn this.$store.getters.getPublicAlbumName(this.albumName)\n\t\t},\n\t},\n\n\tasync beforeMount() {\n\t\tawait this.fetchAlbumInfo()\n\t\tawait this.fetchAlbumContent()\n\t},\n\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'appendFiles',\n\t\t\t'addCollection',\n\t\t\t'addFilesToCollection',\n\t\t\t'removeFilesFromCollection',\n\t\t]),\n\n\t\tasync fetchAlbumInfo() {\n\t\t\tconst album = await this.fetchCollection(\n\t\t\t\t`/photospublic/${this.token}`,\n\t\t\t\t['<nc:location />', '<nc:dateRange />', '<nc:collaborators />', '<nc:original-name />'],\n\t\t\t\tthis.publicClient,\n\t\t\t)\n\n\t\t\tthis.albumOriginalName = album.originalName\n\t\t},\n\n\t\tasync fetchAlbumContent() {\n\t\t\tawait this.fetchCollectionFiles(\n\t\t\t\t`/photospublic/${this.token}`,\n\t\t\t\t['<nc:location />', '<nc:dateRange />', '<nc:collaborators />', '<nc:original-name />'],\n\t\t\t\tthis.publicClient,\n\t\t\t\t[\n\t\t\t\t\tfile => ({\n\t\t\t\t\t\t...file,\n\t\t\t\t\t\t// Use custom preview URL to avoid authentication prompt\n\t\t\t\t\t\tpreviewUrl: generateUrl(`/apps/photos/api/v1/publicPreview/${file.fileid}?x=2048&y=2048&token=${this.token}`),\n\t\t\t\t\t\t// Disable use of generic file previews for public albums - for older versions of the Viewer app\n\t\t\t\t\t\thasPreview: false,\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t)\n\t\t},\n\n\t\tasync handleFilesPicked(fileIds) {\n\t\t\tthis.showAddPhotosModal = false\n\t\t\tawait this.addFilesToCollection({ collectionFileName: this.albumName, fileIdsToAdd: fileIds })\n\t\t\t// Re-fetch album content to have the proper filenames.\n\t\t\tawait this.fetchAlbumContent()\n\t\t},\n\n\t\tasync handleRemoveFilesFromAlbum(fileIds) {\n\t\t\tthis.$refs.collectionContent.onUncheckFiles(fileIds)\n\t\t\tawait this.removeFilesFromCollection({ collectionFileName: this.albumName, fileIdsToRemove: fileIds })\n\t\t},\n\n\t\tt: translate,\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.album {\n\tdisplay: flex;\n\tflex-direction: column;\n\n\t&__title {\n\t\twidth: 100%;\n\t}\n\n\t&__name {\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t&__location {\n\t\tmargin-left: -4px;\n\t\tdisplay: flex;\n\t\tcolor: var(--color-text-lighter);\n\t}\n}\n</style>\n"],"names":["_sfc_main","MapMarker","ImageOff","NcEmptyContent","NcActions","CollectionContent","HeaderNavigation","FetchCollectionContentMixin","isMobile","getClient","generateRemoteUrl","mapActions","album","file","generateUrl","fileIds","translate"],"mappings":"w4BAoBA,MAAAA,EAAA,CACA,KAAA,eACA,MAAA,CAAA,OAAA,EACA,MAAA,CACA,MAAA,CACA,KAAA,MACA,EACA,UAAA,CACA,KAAA,OACA,QAAA,cACA,EACA,KAAA,CACA,KAAA,OACA,QAAA,EACA,CACA,CACA,2pBC0DAA,EAAA,CACA,KAAA,qBACA,WAAA,CACA,UAAAC,EAKA,SAAAC,EACA,eAAAC,EACA,UAAAC,EAGA,kBAAAC,EAEA,iBAAAC,CACA,EAEA,OAAA,CACAC,EACAC,CACA,EAEA,MAAA,CACA,MAAA,CACA,KAAA,OACA,SAAA,EAAA,CAEA,EAEA,MAAA,CACA,MAAA,CACA,mBAAA,GACA,aAAA,EACA,uBAAA,GACA,kBAAA,GACA,aAAAC,EAAAC,EAAA,KAAA,EAAA,CACA,cAAA,SAAA,KAAA,GAAA,KAAA,KAAA,GAAA,CAAA,EACA,CAAA,CACA,CACA,EAEA,SAAA,CACA,OAAA,CACA,OAAA,KAAA,OAAA,QAAA,eAAA,KAAA,SAAA,CACA,EAEA,WAAA,CACA,OAAA,KAAA,KACA,EAEA,cAAA,CACA,OAAA,KAAA,OAAA,QAAA,oBAAA,KAAA,SAAA,CACA,EAEA,qBAAA,CACA,OAAA,KAAA,OAAA,QAAA,mBAAA,KAAA,SAAA,CAAA,CAEA,EAEA,MAAA,aAAA,CACA,MAAA,KAAA,eAAA,EACA,MAAA,KAAA,kBAAA,CACA,EAEA,QAAA,CACA,GAAAC,EAAA,CACA,cACA,gBACA,uBACA,2BAAA,CACA,EAEA,MAAA,gBAAA,CACA,MAAAC,EAAA,MAAA,KAAA,gBACA,iBAAA,KAAA,KAAA,GACA,CAAA,kBAAA,mBAAA,uBAAA,sBAAA,EACA,KAAA,YACA,EAEA,KAAA,kBAAAA,EAAA,YACA,EAEA,MAAA,mBAAA,CACA,MAAA,KAAA,qBACA,iBAAA,KAAA,KAAA,GACA,CAAA,kBAAA,mBAAA,uBAAA,sBAAA,EACA,KAAA,aACA,CACAC,IAAA,CACA,GAAAA,EAEA,WAAAC,EAAA,qCAAAD,EAAA,MAAA,wBAAA,KAAA,KAAA,EAAA,EAEA,WAAA,EACA,EAAA,CAEA,CACA,EAEA,MAAA,kBAAAE,EAAA,CACA,KAAA,mBAAA,GACA,MAAA,KAAA,qBAAA,CAAA,mBAAA,KAAA,UAAA,aAAAA,EAAA,EAEA,MAAA,KAAA,kBAAA,CACA,EAEA,MAAA,2BAAAA,EAAA,CACA,KAAA,MAAA,kBAAA,eAAAA,CAAA,EACA,MAAA,KAAA,0BAAA,CAAA,mBAAA,KAAA,UAAA,gBAAAA,EAAA,CACA,EAEA,EAAAC,CAAA,CAEA","x_google_ignoreList":[0]}