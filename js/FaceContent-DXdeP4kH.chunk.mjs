(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".face[data-v-716c9e34]{display:flex;flex-direction:column}.face__empty[data-v-716c9e34]{display:flex;flex-direction:column;align-items:center}.face__empty__button[data-v-716c9e34]{margin-top:32px}.face__header[data-v-716c9e34]{display:flex;min-height:60px;align-items:center;justify-content:space-between;position:sticky;z-index:3;background:var(--color-main-background);padding:0 64px}@media only screen and (max-width: 1020px){.face__header[data-v-716c9e34]{padding:0 0 0 64px}}.face__header__left[data-v-716c9e34]{height:100%;display:flex;align-items:center}.face__header__title[data-v-716c9e34]{margin-left:10px}.face__header__title h2[data-v-716c9e34]{margin-bottom:0}.face__header__loader[data-v-716c9e34]{margin-left:32px}.face__header__actions[data-v-716c9e34]{display:flex;align-items:center}.face__header__actions button[data-v-716c9e34]{margin-left:16px}.face__photos[data-v-716c9e34]{margin-top:16px;height:100%;min-height:0;padding:0 64px}@media only screen and (max-width: 1020px){.face__photos[data-v-716c9e34]{padding:0}}.empty-content-with-illustration[data-v-716c9e34] .empty-content__icon{width:200px;height:200px}.empty-content-with-illustration[data-v-716c9e34] .empty-content__icon svg{width:200px;height:200px}.rename-form[data-v-716c9e34]{display:flex;flex-direction:row;align-items:center;height:70px;padding:16px}.rename-form input[data-v-716c9e34]{width:100%}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
import{A as n,x as c,e as l,B as r,D as f,C as d,o as u,f as a}from"./index-CYNaqKNs.chunk.mjs";import{P as h}from"./Pencil-CbDoX_Q6.chunk.mjs";import{C as m}from"./Close-BZjlrH3B.chunk.mjs";import{A as p}from"./AlertCircle-BgUCrioB.chunk.mjs";import{S as F}from"./Star-QX_8HVec.chunk.mjs";import{D as v}from"./Download-Dt7lSqW6.chunk.mjs";import{S as g}from"./Send-DNQRPiqH.chunk.mjs";import{n as s}from"./index-Y-UlKA14.chunk.mjs";import{A as _}from"./ArrowLeft-DiWsGsl6.chunk.mjs";import{A as y,F as N}from"./FaceMergeForm-D79FAVnl.chunk.mjs";import{A as C}from"./AccountBoxMultipleOutline-DF21bLW4.chunk.mjs";import{V as w}from"./vue.runtime.esm-Cvc35Ey2.chunk.mjs";import{N as M}from"./NcEmptyContent-D1s5wRoX.chunk.mjs";import{F as k}from"./FetchFilesMixin-CqHqfu3_.chunk.mjs";import{F as S,a as A}from"./FilesListViewer-CuvsdS1s.chunk.mjs";import{F as I}from"./File-Cvym3RbQ.chunk.mjs";import{F as x}from"./FaceCover-CxO7SvP2.chunk.mjs";import"./PhotoSearch-DwRv_oWO.chunk.mjs";import"./AbortControllerMixin-DeafVJKx.chunk.mjs";import"./fileFetcher-DueDmSo0.chunk.mjs";import"./Video-BMa4IOkQ.chunk.mjs";const R={name:"MergeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var B=function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon merge-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(o){return e.$emit("click",o)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M8 17L12 13H15.2C15.6 14.2 16.7 15 18 15C19.7 15 21 13.7 21 12S19.7 9 18 9C16.7 9 15.6 9.8 15.2 11H12L8 7V3H3V8H6L10.2 12L6 16H3V21H8V17Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])},b=[],L=s(R,B,b,!1,null,null);const D=L.exports,$={name:"FaceContent",components:{Pencil:h,Star:F,Download:v,Close:m,AlertCircle:p,Send:g,Merge:D,ArrowLeft:_,AccountBoxMultipleOutline:C,FaceMergeForm:N,FilesListViewer:A,File:I,NcLoadingIcon:u,NcEmptyContent:M,NcActions:d,NcActionButton:f,NcDialog:r,NcButton:l,AccountSwitch:y},directives:{focus(e){w.nextTick(()=>e.focus())}},mixins:[x,k,S],props:{faceName:{type:String,default:"/"}},data(){return{showMoveModal:!1,showMergeModal:!1,showRenameModal:!1,loadingCount:0,appContent:document.getElementById("app-content-vue")}},computed:{...c(["files","facesFiles"]),face(){return this.faces[this.faceName]},faceFileIds(){return this.facesFiles[this.faceName]||[]},shouldFavoriteSelection(){return this.selectedFileIds.some(e=>this.$store.state.files.files[e].favorite===0)}},watch:{face(){this.face&&this.fetchFaceContent(this.faceName)}},mounted(){this.fetchFaceContent(this.faceName)},methods:{...n(["appendFiles","deleteFace","renameFace","downloadFiles","toggleFavoriteForFiles","removeFilesFromFace","moveFilesToFace"]),openViewer(e){const t=this.files[e];OCA.Viewer.open({path:"/"+t.filename.split("/").slice(3).join("/"),list:this.faceFileIds.map(o=>({...this.files[o],filename:"/"+this.files[o].filename.split("/").slice(3).join("/")})),loadMore:t.loadMore?async()=>await t.loadMore(!0):()=>[],canLoop:t.canLoop})},async handleRemoveFilesFromFace(e){try{this.loadingCount++,await this.removeFilesFromFace({faceName:this.faceName,fileIdsToRemove:e}),this.resetSelection()}catch(t){a.error(t)}finally{this.loadingCount--}},async handleDeleteFace(){try{this.loadingCount++,await this.deleteFace({faceName:this.faceName}),this.$router.push("/faces")}catch(e){a.error(e)}finally{this.loadingCount--}},async handleRenameFace(e){try{this.loadingCount++,this.showRenameModal=!1;const t=this.faceName;await this.renameFace({oldName:t,faceName:e}),this.$router.push({name:"facecontent",params:{faceName:e}})}catch(t){a.error(t)}finally{this.loadingCount--}},async handleMerge(e){try{this.loadingCount++,await this.moveFilesToFace({oldFace:this.faceName,faceName:e,fileIdsToMove:this.facesFiles[this.faceName]}),await this.deleteFace({faceName:this.faceName}),this.showMergeModal=!1,this.$router.push({name:"facecontent",params:{faceName:e}})}catch(t){a.error(t)}finally{this.loadingCount--}},async handleMove(e,t){try{this.loadingCount++,await this.moveFilesToFace({oldFace:this.faceName,faceName:e,fileIdsToMove:t}),this.showMoveModal=!1}catch(o){a.error(o)}finally{this.loadingCount--}},async favoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!0})}catch(e){a.error(e)}finally{this.loadingCount--}},async unFavoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!1})}catch(e){a.error(e)}finally{this.loadingCount--}},async downloadSelection(){try{this.loadingCount++,await this.downloadFiles(this.selectedFileIds)}catch(e){a.error(e)}finally{this.loadingCount--}}}};var V=function(){var e=this,t=e._self._c;return e.face===void 0&&!e.loadingFiles&&!e.loadingFaces?t("NcEmptyContent",{staticClass:"empty-content-with-illustration",scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountBoxMultipleOutline")]},proxy:!0}],null,!1,2861705255)},[e._v(" "+e._s(e.t("photos","This person could not be found"))+" ")]):e.errorFetchingFiles||e.errorFetchingFaces?t("NcEmptyContent",{scopedSlots:e._u([{key:"icon",fn:function(){return[t("AlertCircle")]},proxy:!0}])},[e._v(" "+e._s(e.t("photos","An error occurred"))+" ")]):t("div",{staticClass:"face"},[t("div",{staticClass:"face__header"},[t("div",{staticClass:"face__header__left"},[t("NcActions",[t("NcActionButton",{on:{click:function(o){return e.$router.push("/faces/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ArrowLeft")]},proxy:!0}])},[e._v(e._s(e.t("photos","Back"))+" ")])],1),t("div",{staticClass:"face__header__title"},[e.face!==void 0?t("h2",{class:{"face-name":!0,"hidden-visually":e.face.basename.match(/^[0-9]+$/)}},[e._v(" "+e._s(e.face.basename)+" ")]):e._e()]),e.loadingCount>0||e.loadingFaces?t("NcLoadingIcon"):e._e()],1),e.face!==void 0?t("div",{staticClass:"face__header__actions"},[t("NcActions",[t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Rename person")},on:{click:function(o){e.showRenameModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Pencil")]},proxy:!0}],null,!1,514409694)},[e._v(" "+e._s(e.t("photos","Rename person"))+" ")])],1),t("NcActions",{attrs:{"force-menu":!0}},[Object.keys(e.faces).length>1?t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Merge with different person")},on:{click:function(o){e.showMergeModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Merge")]},proxy:!0}],null,!1,3117189691)},[e._v(" "+e._s(e.t("photos","Merge with different person"))+" ")]):e._e(),e.selectedFileIds.length?[t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Download selected files")},on:{click:e.downloadSelection}},[t("Download",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Download selected photos"))+" ")],1),e.shouldFavoriteSelection?t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Mark selection as favorite")},on:{click:e.favoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Favorite"))+" ")],1):t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Remove selection from favorites")},on:{click:e.unFavoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Remove from favorites"))+" ")],1),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(o){e.showMoveModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountSwitch")]},proxy:!0}],null,!1,2937983280)},[e._v(" "+e._s(e.n("photos","Move photo to a different person","Move photos to a different person",e.selectedFileIds.length))+" ")]),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(o){return e.handleRemoveFilesFromFace(e.selectedFileIds)}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Close")]},proxy:!0}],null,!1,1051939733)},[e._v(" "+e._s(e.n("photos","Remove photo from person","Remove photos from person",e.selectedFileIds.length))+" ")])]:e._e(),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:e.handleDeleteFace},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Close")]},proxy:!0}],null,!1,1051939733)},[e._v(" "+e._s(e.t("photos","Remove person"))+" ")])],2)],1):e._e()]),e.face!==void 0?t("FilesListViewer",{staticClass:"face__photos",attrs:{"container-element":e.appContent,"file-ids":e.faceFileIds,loading:e.loadingFiles||e.loadingFaces},scopedSlots:e._u([{key:"default",fn:function({file:o,distance:i}){return t("File",{attrs:{file:e.files[o.id],"allow-selection":!0,selected:e.selection[o.id]===!0,distance:i},on:{click:e.openViewer,"select-toggled":e.onFileSelectToggle}})}}],null,!1,2716306842)}):e._e(),e.showRenameModal?t("NcDialog",{attrs:{name:e.t("photos","Rename person"),"close-on-click-outside":"",size:"small"},on:{closing:function(o){e.showRenameModal=!1}},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{"aria-label":e.t("photos","Save."),type:"primary",disabled:e.$refs.nameInput&&e.$refs.nameInput.value.trim()===""},on:{click:function(o){return e.handleRenameFace(e.$refs.nameInput.value)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loadingCount?t("NcLoadingIcon"):t("Send")]},proxy:!0}],null,!1,564208483)},[e._v(" "+e._s(e.t("photos","Save"))+" ")])]},proxy:!0}],null,!1,300100074)},[t("div",{staticClass:"rename-form"},[t("input",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameInput",attrs:{type:"text",name:"name",required:"",placeholder:e.t("photos","Name of this person")},domProps:{value:e.faceName},on:{keydown:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.handleRenameFace(e.$refs.nameInput.value)}}})])]):e._e(),e.showMergeModal?t("NcDialog",{attrs:{name:e.t("photos","Merge person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(o){e.showMergeModal=!1}}},[t("FaceMergeForm",{attrs:{"first-face":e.faceName},on:{select:function(o){return e.handleMerge(o)}}})],1):e._e(),e.showMoveModal?t("NcDialog",{attrs:{name:e.t("photos","Move to different person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(o){e.showMoveModal=!1}}},[t("FaceMergeForm",{attrs:{"first-face":e.faceName},on:{select:function(o){return e.handleMove(o,e.selectedFileIds)}}})],1):e._e()],1)},T=[],z=s($,V,T,!1,null,"716c9e34");const ne=z.exports;export{ne as default};
//# sourceMappingURL=FaceContent-DXdeP4kH.chunk.mjs.map
