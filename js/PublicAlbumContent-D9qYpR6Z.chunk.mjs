import{j as i,M as l,n as a}from"./icons-DIHlkdtB.chunk.mjs";import{A as n}from"./index-_ht8pMWC.chunk.mjs";import{t as s,_ as r,R as c,a6 as m}from"./vue.runtime.esm-C8-0a0Ou.chunk.mjs";import{N as u}from"./NcEmptyContent-D12NO0zu.chunk.mjs";import{i as h}from"./isMobile-B-1-Y9j1.chunk.mjs";import{C as b}from"./CollectionContent-CY13WZSl.chunk.mjs";import{H as d}from"./HeaderNavigation-C7LWWzCX.chunk.mjs";import{F as p}from"./FetchCollectionContentMixin-D1KYLXxB.chunk.mjs";import"./index-s-2zgmtE.chunk.mjs";import"./FilesListViewer-Bp87k_yS.chunk.mjs";import"./fileFetcher-Ck5ykhkN.chunk.mjs";import"./File-C8zB0CvM.chunk.mjs";import"./AbortControllerMixin-D4w_j-jP.chunk.mjs";import"./collectionFetcher-o8pWVjsB.chunk.mjs";const f={name:"PublicAlbumContent",components:{MapMarker:l,ImageOff:i,NcEmptyContent:u,NcActions:n,CollectionContent:b,HeaderNavigation:d},mixins:[p,h],props:{token:{type:String,required:!0}},data(){return{showAddPhotosModal:!1,loadingCount:0,loadingAddFilesToAlbum:!1,albumOriginalName:"",publicClient:c(m("dav"),{Authorization:`Basic ${btoa(`${this.token}:`)}`})}},computed:{album(){return this.$store.getters.getPublicAlbum(this.albumName)},albumName(){return this.token},albumFileIds(){return this.$store.getters.getPublicAlbumFiles(this.albumName)},publicAlbumFileName(){return this.$store.getters.getPublicAlbumName(this.albumName)}},async beforeMount(){await this.fetchAlbumInfo(),await this.fetchAlbumContent()},methods:{async fetchAlbumInfo(){const t=await this.fetchCollection(`/photospublic/${this.token}`,["<nc:location />","<nc:dateRange />","<nc:collaborators />","<nc:original-name />"],this.publicClient);t!==null&&(this.albumOriginalName=t.attributes["original-name"])},async fetchAlbumContent(){(await this.fetchCollectionFiles(`/photospublic/${this.token}`,["<nc:location />","<nc:dateRange />","<nc:collaborators />","<nc:original-name />"],this.publicClient)).forEach(t=>{t.update({previewUrl:r(`/apps/photos/api/v1/publicPreview/${t.fileid}?x=2048&y=2048&token=${this.token}`),hasPreview:!1})})},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.$store.dispatch("addFilesToCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.$store.dispatch("removeFilesFromCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToRemove:t})},t:s}};var g=function(){var t=this,o=t._self._c;return o("div",[o("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,"allow-selection":!1,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:e}){return t.albumOriginalName!==""?o("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollection||t.loadingCollectionFiles,params:{token:t.token},path:"/","root-title":t.albumOriginalName,title:t.albumOriginalName},on:{refresh:t.fetchAlbumContent}},[t.album.attributes.location!==""?o("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[o("MapMarker"),t._v(t._s(t.album.attributes.location)+" ")],1):t._e(),t.album!==void 0?o("template",{slot:"right"},[o("NcActions",{attrs:{"force-menu":!0,"aria-label":t.t("photos","Open actions menu")}},[e.length>0?void 0:t._e()],2)],1):t._e()],2):t._e()}}],null,!0)},[o("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[o("ImageOff",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1)},C=[],F=a(f,g,C,!1,null,"e3b5dc18");const x=F.exports;export{x as default};
//# sourceMappingURL=PublicAlbumContent-D9qYpR6Z.chunk.mjs.map
