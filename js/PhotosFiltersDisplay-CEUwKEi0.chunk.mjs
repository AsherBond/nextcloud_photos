import{d as p,b as i,x as m,t as v,a1 as g,z as c,B as C,_ as f}from"./vue.runtime.esm-BRCPjOl-.chunk.mjs";import{b,a as P,N as S}from"./NcDateTimePicker-Ch-z79Fw.chunk.mjs";import{n as u,B as x,M as N}from"./icons-nZl_T3UH.chunk.mjs";import{N as k}from"./NcDateTime-DshRFtUU-Bv6u-zYn.chunk.mjs";import{n as w,a as D,b as I,s as A,al as $,r as M,X as R,am as T,p as d,l as W,af as F}from"./index-Mvpvp-tP.chunk.mjs";import{N as U}from"./NcActionButton-CuVNJJtW-BQjq27Lb.chunk.mjs";import{f as V}from"./collectionFetcher-Pk204uqn.chunk.mjs";import{d as B}from"./index-BQM-zcNX.chunk.mjs";const j=p({__name:"DateRangeFilterInput",props:{value:null},emits:["update:value"],setup(e,{emit:a}){const t=e,l=i([null,null]);return t.value!==void 0&&(l.value=[new Date(t.value.start),new Date(t.value.end)]),m(l,o=>{o[0]===null||o[1]===null?a("update:value",void 0):a("update:value",{start:o[0].getTime(),end:o[1].getTime()})}),{__sfc:!0,props:t,emit:a,dateRange:l,t:v,NcDateTimePicker:b}}});var L=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcDateTimePicker,{attrs:{clearable:!0,type:"date-range",placeholder:t.t("photos","Select a date range")},scopedSlots:e._u([{key:"default",fn:function(){return[e._v(" "+e._s(t.t("photos","Date range"))+" ")]},proxy:!0}]),model:{value:t.dateRange,callback:function(l){t.dateRange=l},expression:"dateRange"}})},q=[],z=u(j,L,q,!1,null,null);const E=z.exports,O=p({__name:"DateRangeFilterDisplay",props:{value:null},setup(e){return{__sfc:!0,CalendarMonth:x,t:v,NcDateTime:k}}});var Q=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return e.value!==void 0?a("div",[a(t.CalendarMonth),e._v(" "),a("b",[e._v(e._s(t.t("photos","Date range"))+": ")]),a("span",[a(t.NcDateTime,{attrs:{timestamp:e.value.start,format:{dateStyle:"long"},"relative-time":!1}}),e._v(" â¸± "),a(t.NcDateTime,{attrs:{timestamp:e.value.end,format:{dateStyle:"long"},"relative-time":!1}})],1)],1):e._e()},X=[],G=u(O,Q,X,!1,null,null);const H=G.exports,J="date-range",K={id:J,inputComponent:E,displayComponent:H,getQuery(e){return e===void 0?"":`
			<d:and>
				<d:gt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${e.start/1e3}</d:literal>
				</d:gt>
				<d:lt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${e.end/1e3+24*60*60}</d:literal>
				</d:lt>
			</d:and>`}};M(R);const Y={__name:"NcChip",props:{ariaLabelClose:{type:String,default:D("Close")},actionsContainer:{type:String,default:"body"},text:{type:String,default:""},type:{type:String,default:"secondary",validator:e=>["primary","secondary","tertiary"].includes(e)},iconPath:{type:String,default:null},iconSvg:{type:String,default:null},noClose:{type:Boolean,default:!1},variant:{type:String,default:"secondary",validator:e=>["primary","secondary","tertiary"].includes(e)}},emits:["close"],setup(e,{emit:a}){const t=e,l=g(),o=c(()=>t.type!=="secondary"?t.type:t.variant),n=c(()=>!t.noClose);return{__sfc:!0,props:t,emit:a,slots:l,realVariant:o,canClose:n,hasActions:()=>!!l.actions?.(),hasIcon:()=>!!(t.iconPath||t.iconSvg||l.icon?.()),onClose:()=>{a("close")},mdiClose:$,NcActions:A,NcActionButton:U,NcIconSvgWrapper:I}}};var Z=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{staticClass:"nc-chip",class:{[`nc-chip--${t.realVariant}`]:!0,"nc-chip--no-actions":e.noClose&&!t.hasActions(),"nc-chip--no-icon":!t.hasIcon()}},[t.hasIcon()?a("span",{staticClass:"nc-chip__icon"},[e._t("icon",function(){return[e.iconPath||e.iconSvg?a(t.NcIconSvgWrapper,{attrs:{inline:"",path:e.iconPath,svg:e.iconPath?void 0:e.iconSvg,size:18}}):e._e()]})],2):e._e(),a("span",{staticClass:"nc-chip__text"},[e._t("default",function(){return[e._v(e._s(e.text))]})],2),t.canClose||t.hasActions()?a(t.NcActions,{staticClass:"nc-chip__actions",attrs:{container:e.actionsContainer,"force-menu":!t.canClose,variant:"tertiary-no-background"}},[t.canClose?a(t.NcActionButton,{attrs:{"close-after-click":""},on:{click:t.onClose},scopedSlots:e._u([{key:"icon",fn:function(){return[a(t.NcIconSvgWrapper,{attrs:{path:t.mdiClose,size:20}})]},proxy:!0}],null,!1,2547223506)},[e._v(" "+e._s(e.ariaLabelClose)+" ")]):e._e(),e._t("actions")],2):e._e()],1)},ee=[],te=w(Y,Z,ee,!1,null,"a7b8715a");const h=te.exports;function ae(){const e=i(new AbortController),a=c(()=>e.value.signal);function t(){e.value.abort(),e.value=new AbortController}return C(()=>{e.value.abort()}),B.beforeEach((l,o,n)=>{t(),n()}),{abortSignal:a,abortPendingRequest:t}}function le(){const e=i(null),a=i(!1),{abortSignal:t}=ae();async function l(o,n=[],_=T){if(a.value)return[];try{a.value=!0,e.value=null;const s=await V(o,{signal:t.value},n,_);return d.dispatch("addCollections",{collections:s}),s}catch(s){s.response?.status===404?e.value=404:e.value=s,W.error("Error fetching collections:",{error:s})}finally{a.value=!1}return[]}return{fetchCollections:l,errorFetchingCollections:e,loadingCollections:a}}function y(e,a){const{fetchCollections:t,loadingCollections:l}=le(),o=i([]),n=c({get(){return(e.value??[]).map(s=>{const r=d.getters.getPlace(s);return{label:r?.displayname??s,previewUrl:r?f(`/apps/photos/api/v1/preview/${r.attributes["last-photo"]}?x=64&y=64`):void 0}})},set(s){s.length===0?a("update:value",void 0):a("update:value",s.map(r=>r.label))}}),_=c(()=>o.value.filter(s=>!n.value.includes(s)));return m(()=>d.getters.places,s=>{o.value=Object.values(s).map(r=>({label:r.displayname,previewUrl:f(`/apps/photos/api/v1/preview/${r.attributes["last-photo"]}?x=64&y=64`)}))},{immediate:!0}),Object.values(d.getters.places).length===0&&t(F),{availablePlacesWithoutSelections:_,selectedPlaces:n,loadingCollections:l}}const se=p({__name:"PlacesFilterInput",props:{value:null},emits:["update:value"],setup(e,{emit:a}){const t=e,{availablePlacesWithoutSelections:l,loadingCollections:o,selectedPlaces:n}=y(t,a);return{__sfc:!0,props:t,emit:a,availablePlacesWithoutSelections:l,loadingCollections:o,selectedPlaces:n,NcSelect:S,NcChip:h,NcListItemIcon:P,t:v}}});var oe=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcSelect,{staticClass:"places-select",attrs:{options:t.availablePlacesWithoutSelections,"aria-label-combobox":t.t("photos","Select places"),placeholder:t.t("photos","Select places"),loading:t.loadingCollections,multiple:!0},scopedSlots:e._u([{key:"option",fn:function(l){return[a(t.NcListItemIcon,{attrs:{name:l.label,"is-no-user":!0,url:l.previewUrl}})]}},{key:"selected-option",fn:function(l){return[a(t.NcChip,{attrs:{"no-close":""},scopedSlots:e._u([{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:l.previewUrl}})]},proxy:!0},{key:"default",fn:function(){return[e._v(" "+e._s(l.label)+" ")]},proxy:!0}],null,!0)})]}}]),model:{value:t.selectedPlaces,callback:function(l){t.selectedPlaces=l},expression:"selectedPlaces"}})},ne=[],re=u(se,oe,ne,!1,null,"a5104e27");const ie=re.exports,ce=p({__name:"PlacesFilterDisplay",props:{value:null},emits:["update:value"],setup(e,{emit:a}){const t=e,{selectedPlaces:l}=y(t,a);return{__sfc:!0,props:t,emit:a,selectedPlaces:l,MapMarker:N,t:v,NcChip:h}}});var pe=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",[a(t.MapMarker),e._v(" "),a("b",[e._v(e._s(t.t("photos","Places"))+": ")]),e._l(t.selectedPlaces,function(l){return a("span",{key:l.label},[a(t.NcChip,{attrs:{"no-close":""},scopedSlots:e._u([l.previewUrl!==void 0?{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:l.previewUrl}})]},proxy:!0}:null,{key:"default",fn:function(){return[e._v(" "+e._s(l.label)+" ")]},proxy:!0}],null,!0)})],1)})],2)},ue=[],de=u(ce,pe,ue,!1,null,"305ae464");const ve=de.exports,_e="places",fe={id:_e,inputComponent:ie,displayComponent:ve,getQuery(e){return e===void 0?"":`<d:or>${e.map(a=>`
			<d:eq>
				<d:prop><nc:metadata-photos-place/></d:prop>
				<d:literal>${a}</d:literal>
			</d:eq>
		`).join("")}</d:or>`}},me=[K,fe],he=p({__name:"PhotosFiltersDisplay",props:{filtersValue:null},setup(e){return{__sfc:!0,filters:me}}});var ye=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return Object.keys(e.filtersValue).length!==0?a("div",{staticClass:"photos-filters"},e._l(t.filters.filter(l=>e.filtersValue[l.id]!==void 0),function(l){return a(l.displayComponent,{key:l.id,tag:"component",staticClass:"photos-filters__filter",attrs:{value:e.filtersValue[l.id],"data-cy-photos-filters-display":l.id}})}),1):e._e()},ge=[],Ce=u(he,ye,ge,!1,null,"f22d923d");const Ie=Ce.exports;export{Ie as P,me as p};
//# sourceMappingURL=PhotosFiltersDisplay-CEUwKEi0.chunk.mjs.map
