import{r as Z,s as J,w as Q,q as U,x as q,f as _,o as ee}from"./index-C1IyPqGx.chunk.mjs";import{V as j,_ as x,g as E,S as te,Z as ie,$ as re}from"./vue.runtime.esm-K-L1yEsQ.chunk.mjs";import{N as oe}from"./NcEmptyContent-ChIhDufb.chunk.mjs";import{U as ne,g as ae}from"./index-Dkr9ebK1-Cyz6Y4Kh.chunk.mjs";import"./index-BVT_DGaS.chunk.mjs";import{n as S,c as H}from"./icons-CCMXs15V.chunk.mjs";import{A as B}from"./AbortControllerMixin-DeafVJKx.chunk.mjs";import{H as se}from"./HeaderNavigation-CxmWv1eF.chunk.mjs";import{f as le}from"./fileFetcher-C0FnP1wD.chunk.mjs";import"./index-D-GU54Qs.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./index-B4X19shb.chunk.mjs";var de=Object.defineProperty,ce=Object.defineProperties,fe=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,I=(e,i,r)=>i in e?de(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,N=(e,i)=>{for(var r in i||(i={}))ue.call(i,r)&&I(e,r,i[r]);if(W)for(var r of W(i))he.call(i,r)&&I(e,r,i[r]);return e},T=(e,i)=>ce(e,fe(i));function O(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?O=function(i){return typeof i}:O=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},O(e)}function pe(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function me(e){return ge(e)||we(e)||ye()}function ge(e){if(Array.isArray(e)){for(var i=0,r=new Array(e.length);i<e.length;i++)r[i]=e[i];return r}}function we(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function ye(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ve(){return typeof Reflect<"u"&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function be(e,i){D(e,i),Object.getOwnPropertyNames(i.prototype).forEach(function(r){D(e.prototype,i.prototype,r)}),Object.getOwnPropertyNames(i).forEach(function(r){D(e,i,r)})}function D(e,i,r){var o=r?Reflect.getOwnMetadataKeys(i,r):Reflect.getOwnMetadataKeys(i);o.forEach(function(n){var s=r?Reflect.getOwnMetadata(n,i,r):Reflect.getOwnMetadata(n,i);r?Reflect.defineMetadata(n,s,e,r):Reflect.defineMetadata(n,s,e)})}var Ce={__proto__:[]},Oe=Ce instanceof Array;function $(e){return function(i,r,o){var n=typeof i=="function"?i:i.constructor;n.__decorators__||(n.__decorators__=[]),typeof o!="number"&&(o=void 0),n.__decorators__.push(function(s){return e(s,r,o)})}}function _e(e){var i=O(e);return e==null||i!=="object"&&i!=="function"}function je(e,i){var r=i.prototype._init;i.prototype._init=function(){var s=this,d=Object.getOwnPropertyNames(e);if(e.$options.props)for(var l in e.$options.props)e.hasOwnProperty(l)||d.push(l);d.forEach(function(a){Object.defineProperty(s,a,{get:function(){return e[a]},set:function(c){e[a]=c},configurable:!0})})};var o=new i;i.prototype._init=r;var n={};return Object.keys(o).forEach(function(s){o[s]!==void 0&&(n[s]=o[s])}),n}var L=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function A(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};i.name=i.name||e._componentTag||e.name;var r=e.prototype;Object.getOwnPropertyNames(r).forEach(function(l){if(l!=="constructor"){if(L.indexOf(l)>-1){i[l]=r[l];return}var a=Object.getOwnPropertyDescriptor(r,l);a.value!==void 0?typeof a.value=="function"?(i.methods||(i.methods={}))[l]=a.value:(i.mixins||(i.mixins=[])).push({data:function(){return pe({},l,a.value)}}):(a.get||a.set)&&((i.computed||(i.computed={}))[l]={get:a.get,set:a.set})}}),(i.mixins||(i.mixins=[])).push({data:function(){return je(this,e)}});var o=e.__decorators__;o&&(o.forEach(function(l){return l(i)}),delete e.__decorators__);var n=Object.getPrototypeOf(e.prototype),s=n instanceof j?n.constructor:j,d=s.extend(i);return Re(d,e,s),ve()&&be(d,e),d}var Se={prototype:!0,arguments:!0,callee:!0,caller:!0};function Re(e,i,r){Object.getOwnPropertyNames(i).forEach(function(o){if(!Se[o]){var n=Object.getOwnPropertyDescriptor(e,o);if(!(n&&!n.configurable)){var s=Object.getOwnPropertyDescriptor(i,o);if(!Oe){if(o==="cid")return;var d=Object.getOwnPropertyDescriptor(r,o);if(!_e(s.value)&&d&&d.value===s.value)return}Object.defineProperty(e,o,s)}}})}function V(e){return typeof e=="function"?A(e):function(i){return A(i,e)}}V.registerHooks=function(e){L.push.apply(L,me(e))};function Fe(e){return typeof e!="function"||!e.managed&&!e.managedReactive}function De(e){var i=function(){var r=this,o=typeof e=="function"?e.call(this):e;o=Object.create(o||null),o[y]=Object.create(this[y]||{});for(var n in i.managed)o[i.managed[n]]=this[n];var s=function(l){o[i.managedReactive[l]]=d[l],Object.defineProperty(o[y],i.managedReactive[l],{enumerable:!0,configurable:!0,get:function(){return r[l]}})},d=this;for(var n in i.managedReactive)s(n);return o};return i.managed={},i.managedReactive={},i}var y="__reactiveInject__";function Le(e){Array.isArray(e.inject)||(e.inject=e.inject||{},e.inject[y]={from:y,default:{}})}var xe=typeof Reflect<"u"&&typeof Reflect.getMetadata<"u";function Ee(e,i,r){if(xe&&!Array.isArray(e)&&typeof e!="function"&&!e.hasOwnProperty("type")&&typeof e.type>"u"){var o=Reflect.getMetadata("design:type",i,r);o!==Object&&(e.type=o)}}function p(e){return e===void 0&&(e={}),function(i,r){Ee(e,i,r),$(function(o,n){(o.props||(o.props={}))[n]=e})(i,r)}}function v(e){return $(function(i,r){var o=i.provide;Le(i),Fe(o)&&(o=i.provide=De(o)),o.managedReactive[r]=r})}function $e(e,i){i===void 0&&(i={});var r=i.deep,o=r===void 0?!1:r,n=i.immediate,s=n===void 0?!1:n;return $(function(d,l){typeof d.watch!="object"&&(d.watch=Object.create(null));var a=d.watch;typeof a[e]=="object"&&!Array.isArray(a[e])?a[e]=[a[e]]:typeof a[e]>"u"&&(a[e]=[]),a[e].push({handler:l,deep:o,immediate:s})})}const Me=(e,i)=>e>720&&i>480?10:5,ze=e=>Math.floor(e/250),Pe=e=>Math.round(e*1.5),We=(e,i,r)=>{const o=e/i;return Math.round(r*o)},k=(e,...i)=>{e&&console.debug(...i)};var Ie=Object.defineProperty,Ne=Object.getOwnPropertyDescriptor,u=(e,i,r,o)=>{for(var n=o>1?void 0:o?Ne(i,r):i,s=e.length-1,d;s>=0;s--)(d=e[s])&&(n=(o?d(i,r,n):d(n))||n);return o&&n&&Ie(i,r,n),n};let f=class extends j{constructor(){super(...arguments),this.updateLock=!1,this.bottomReached=!1,this.ref=null,this.containerData={windowSize:{height:0,width:0},windowScroll:{x:0,y:0},elementWindowOffset:0,elementSize:{height:0,width:0}}}get loadingBatch(){return this.loader&&this.updateLock}get configData(){return this.computeConfigData(this.containerData,this.items)}get layoutData(){return this.computeLayoutData(this.configData)}get renderData(){return this.computeRenderData(this.configData,this.containerData,this.layoutData)}mounted(){var e;this.ref=this.$refs.virtualGrid,this.initiliazeGrid(),window.addEventListener("resize",this.resize),((e=this.scrollElement)!=null?e:window).addEventListener("scroll",this.scroll)}beforeDestroy(){var e;window.removeEventListener("resize",this.resize),((e=this.scrollElement)!=null?e:window).removeEventListener("scroll",this.scroll)}onScrollElementChanged(e,i){(i??window).removeEventListener("scroll",this.scroll),(e??window).addEventListener("scroll",this.scroll)}resize(){this.loadMoreData()}scroll(){this.loadMoreData()}initiliazeGrid(){this.computeContainerData(),this.$nextTick(async()=>{this.loadMoreData()})}loadMoreData(){this.loadMoreDataAsync().catch(e=>{e&&console.error("Fail to load next data batch",e)}).then()}async loadMoreDataAsync(){this.computeContainerData();const e=this.containerData.windowScroll.y+this.containerData.windowSize.height,i=Math.max(0,this.containerData.elementWindowOffset+this.containerData.elementSize.height-this.updateTriggerMargin);!this.bottomReached&&e>=i&&!this.updateLock&&(this.updateLock=!0,k(this.debug,"Loading next batch"),await this.updateFunction()&&(k(this.debug,"Bottom reached"),this.bottomReached=!0),this.updateLock=!1,await this.loadMoreDataAsync())}computeContainerData(){if(this.ref===null)return;const e=this.getWindowSize(),i=this.getWindowScroll(),r=this.getElementOffset(this.ref),o=this.getElementSize(this.ref);this.containerData={windowSize:e,windowScroll:i,elementWindowOffset:r,elementSize:o}}computeConfigData(e,i){if(e===null||i===null)return{windowMargin:0,gridGap:0,columnCount:1,entries:[]};const r=e.elementSize?e.elementSize.width:0,o=this.getWindowMargin(e.windowSize.height),n=this.getGridGap(r,e.windowSize.height),s=this.getColumnCount(r),d=this.getColumnWidth(s,n,r),l=i.map(a=>{if(!a.width)return a;const c=d*a.columnSpan+n*(a.columnSpan-1);return T(N({},a),{height:this.getItemRatioHeight(a.height,a.width,c),width:c})});return{windowMargin:o,gridGap:n,columnCount:s,entries:l}}computeLayoutData(e){if(e===null)return{cells:[],totalHeight:0};let i=1,r=0,o=0,n=0;const s=e.entries.map((l,a)=>{const{columnCount:c,gridGap:w}=e;let h=l.columnSpan,m=l.height;h<1&&(h=c);const g=(a+n)%c;l.newRow&&g!==0&&(n+=c-g);const M=a+n,R=M%c+1,F=Math.floor(M/c)+1;if(R+h>c+1){const P=R+h-c-1,X=P/h;m=m*(1-X),h-=P}h>1&&(n+=h-1),F!==i&&(i=F,r+=o+w,o=0);const Y=r,z=Math.round(m);return o=Math.max(o,z),T(N({},l),{columnNumber:R,rowNumber:F,offset:Y,height:z,columnSpan:h})}),d=r+o;return{cells:s,totalHeight:d}}computeRenderData(e,i,r){if(r===null||e===null)return{cellsToRender:[],firstRenderedRowNumber:0,firstRenderedRowOffset:0};const o=[];let n=null,s=null;if(i.elementWindowOffset!==null){const d=i.elementWindowOffset;for(const l of r.cells){const a=d+l.offset,c=a+l.height,w=i.windowScroll.y,h=w+i.windowSize.height,m=w-e.windowMargin,g=h+e.windowMargin;a>g||c<m||(n===null&&(n=l.rowNumber),l.rowNumber===n&&(s=s?Math.min(s,l.offset):l.offset),o.push(l))}}return{cellsToRender:o,firstRenderedRowNumber:n,firstRenderedRowOffset:s}}getColumnWidth(e,i,r){if(e===null||i===null||r===null)return 0;const o=(e-1)*i;return Math.round((r-o)/e)}getGridRowStart(e,i){if(i===null)return;const r=i.firstRenderedRowNumber!==null?i.firstRenderedRowNumber-1:0;return`${e.rowNumber-r}`}resetGrid(){this.bottomReached=!1,this.loadMoreData()}isSameElementSize(e,i){return e.width===i.width&&e.height===i.height}getWindowSize(){return{width:window.innerWidth,height:window.innerHeight}}getElementSize(e){const i=e.getBoundingClientRect();return{width:i.width,height:i.height}}isSameElementScroll(e,i){return e.x===i.x&&e.y===i.y}getWindowScroll(){return{x:window.scrollX,y:window.scrollY}}getElementOffset(e){return window.scrollY+e.getBoundingClientRect().top}};u([p({required:!0})],f.prototype,"items",2),u([p({default:()=>()=>!0})],f.prototype,"updateFunction",2),u([p({default:()=>Me})],f.prototype,"getGridGap",2),u([p({default:()=>ze})],f.prototype,"getColumnCount",2),u([p({default:()=>Pe})],f.prototype,"getWindowMargin",2),u([p({default:()=>We})],f.prototype,"getItemRatioHeight",2),u([p({default:null})],f.prototype,"scrollElement",2),u([p({default:500})],f.prototype,"updateTriggerMargin",2),u([p({default:null})],f.prototype,"loader",2),u([p({default:!1})],f.prototype,"debug",2),u([v()],f.prototype,"updateLock",2),u([v()],f.prototype,"bottomReached",2),u([v()],f.prototype,"ref",2),u([v()],f.prototype,"containerData",2),u([$e("scrollElement")],f.prototype,"onScrollElementChanged",1),f=u([V({name:"VirtualGrid"})],f);var Te=function(){var e=this,i=e.$createElement,r=e._self._c||i;return r("div",{ref:"virtualGrid",style:{boxSizing:"border-box",height:e.layoutData.totalHeight+"px",paddingTop:e.renderData!==null&&e.renderData.firstRenderedRowOffset!==null?e.renderData.firstRenderedRowOffset+"px":"0px"}},[r("div",{staticClass:"grid",style:{display:"-ms-grid",display:"grid","align-items":"center","grid-template-columns":"repeat("+e.configData.columnCount+", 1fr)",gap:e.configData.gridGap+"px"}},e._l(e.renderData.cellsToRender,function(o){return r("div",{key:o.id,staticClass:"grid-item-wrapper",style:{height:o.height+"px","grid-column-start":o.columnNumber,"grid-column-end":o.columnNumber+o.columnSpan,"grid-row-start":e.getGridRowStart(o,e.renderData)}},[r(o.renderComponent,e._g({tag:"component",attrs:{item:o}},e.$listeners))],1)}),0),r(e.loadingBatch&&e.loader,{tag:"component"})],1)},Ae=[];function ke(e,i,r,o,n,s,d,l){var a=typeof e=="function"?e.options:e;i&&(a.render=i,a.staticRenderFns=r,a._compiled=!0);var c;if(n&&(c=n),c)if(a.functional){a._injectStyles=c;var w=a.render;a.render=function(m,g){return c.call(g),w(m,g)}}else{var h=a.beforeCreate;a.beforeCreate=h?[].concat(h,c):[c]}return{exports:e,options:a}}const G={};var Ge=ke(f,Te,Ae,!1,Ue);function Ue(e){for(let i in G)this[i]=G[i]}var qe=function(){return Ge.exports}();const He={name:"FileLegacy",inheritAttrs:!1,props:{item:{type:Object,required:!0}},data(){return{loaded:!1,error:!1}},computed:{ariaUuid(){return`image-${this.item.injected.fileid}`},ariaLabel(){return t("photos",'Open the full size "{name}" image',{name:this.item.injected.basename})},isImage(){return this.item.injected.mime.startsWith("image")},decodedEtag(){return this.item.injected.etag.replace("&quot;","").replace("&quot;","")},src(){return x(`/core/preview?fileId=${this.item.injected.fileid}&c=${this.decodedEtag}&x=250&y=250&forceIcon=0&a=${this.croppedLayout?"0":"1"}`)},croppedLayout(){return this.$store.state.userConfig.croppedLayout}},beforeDestroy(){this.$refs.src=""},methods:{openViewer(){OCA.Viewer.open({fileInfo:this.item.injected,list:this.item.injected.list,loadMore:this.item.injected.loadMore?async()=>await this.item.injected.loadMore(!0):()=>[],canLoop:this.item.injected.canLoop})},onLoad(){this.loaded=!0},onError(){this.error=!0}}};var Be=function(){var e=this,i=e._self._c;return i("a",{staticClass:"file",class:{"file--cropped":e.croppedLayout},attrs:{href:e.item.injected.source,"aria-label":e.ariaLabel},on:{click:function(r){return r.preventDefault(),e.openViewer.apply(null,arguments)}}},[e.item.injected.mime.includes("video")&&e.item.injected.hasPreview?i("div",{staticClass:"icon-video-white"}):e._e(),i("transition-group",{staticClass:"transition-group",attrs:{name:"fade"}},[e.error?e._e():i("img",{key:`${e.item.injected.basename}-img`,ref:"img",attrs:{src:e.src,alt:e.item.injected.basename,"aria-describedby":e.ariaUuid},on:{load:e.onLoad,error:e.onError}}),!e.loaded||e.error?i("svg",{key:`${e.item.injected.basename}-svg`,attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"url(#placeholder__gradient)"}},[e.isImage?i("use",{attrs:{href:"#placeholder--img"}}):i("use",{attrs:{href:"#placeholder--video"}})]):e._e()]),i("p",{staticClass:"hidden-visually",attrs:{id:e.ariaUuid}},[e._v(e._s(e.item.injected.basename))]),i("div",{staticClass:"cover",attrs:{role:"none"}})],1)},Ve=[],Ke=S(He,Be,Ve,!1,null,"054bc81d");const Ye=Ke.exports,Xe={name:"FolderTagPreview",components:{Folder:H},props:{icon:{type:String,default:"icon-folder"},id:{type:[Number,String],required:!0},name:{type:String,required:!0},path:{type:String,default:""},fileList:{type:Array,default:()=>[]},to:{type:Object,default:null}},data(){return{failed:[]}},computed:{isEmpty(){return this.previewList.length===0},ariaLabel(){return t("photos",'Open the "{name}" folder',{name:this.name})},previewList(){return this.fileList.filter(e=>this.failed.indexOf(e.fileid)===-1)},previewUrl(){if(this.previewList.length===0)return null;const{fileid:e,etag:i}=this.previewList.at(-1);return x(`/core/preview?fileId=${e}&c=${i}&x=250&y=250&forceIcon=0&a=0`)},toLink(){if(this.to)return this.to;const e=`/files/${E()?.uid}`;let i=this.path.replace(new RegExp(`^${e}`),"");return i=/^\/?(.+)/i.exec(i)[1],Object.assign({},this.$route,{params:{path:i.split("/")}})}},methods:{onPreviewFail({fileid:e}){this.failed.push(e)}}};var Ze=function(){var e=this,i=e._self._c;return i("router-link",{staticClass:"folder",attrs:{to:e.toLink,"aria-label":e.ariaLabel}},[e.previewUrl?i("img",{staticClass:"folder__image",attrs:{src:e.previewUrl,alt:""},on:{error:function(r){return e.onPreviewFail(e.file)}}}):i("span",{staticClass:"folder__image folder__image--placeholder"},[i("Folder",{staticClass:"folder__icon",attrs:{size:96,"fill-color":"var(--color-primary-element)"}})],1),i("span",{staticClass:"folder__details"},[i("Folder"),i("span",{staticClass:"folder__title"},[e._v(e._s(e.name))])],1)])},Je=[],Qe=S(Xe,Ze,Je,!1,null,"f97fb29d");const et=Qe.exports;async function K(e="/",i={}){const r=x(`/apps/photos/api/v1/${i.shared?"shared":"albums"}`),o=`/files/${E()?.uid}`,n=(await Z.get(r+J(e),i)).data.map(a=>({...a,filename:`${o}${a.filename}`})).map(a=>Q(a));let s;const d=[],l=[];for(const a of n)a.filename===`${o}${e}`?s=a:a.type!=="file"?d.push(a):U.indexOf(a.mime)>-1&&l.push(a);return{folder:s,folders:d,files:l}}const tt={name:"Folder",components:{FolderTagPreview:et},mixins:[B],inheritAttrs:!1,props:{item:{type:Object,required:!0}},data(){return{previewFolder:this.item.injected.fileid}},computed:{...q(["files","folders"]),folderContent(){return this.folders[this.item.injected.fileid]},previewFiles(){const e=this.folders[this.previewFolder],i=e?e.map(r=>this.files[r]).slice(0,4):[];if(i.length===0&&this.files[this.previewFolder].folders&&this.previewFolder===this.item.injected.fileid){const r=this.files[this.previewFolder].folders[0];this.updatePreviewFolder(r),this.folders[this.previewFolder]||this.getFolderData(this.files[this.previewFolder].filename)}return i}},async created(){this.folderContent||await this.getFolderData(this.item.injected.filename)},methods:{async getFolderData(e){try{const i=`/files/${E()?.uid}`,r=e.replace(new RegExp(`^${i}`),""),{folder:o,folders:n,files:s}=await K(r,{shared:this.item.injected.showShared,signal:this.abortController.signal});this.$store.dispatch("updateFolders",{fileid:o.fileid,files:s,folders:n}),this.$store.dispatch("updateFiles",{folder:o,files:s,folders:n})}catch(i){i.response&&i.response.status?_.error("Failed to get folder content",{error:i,filename:e}):_.debug(i)}},updatePreviewFolder(e){this.previewFolder=e}}};var it=function(){var e=this,i=e._self._c;return i("FolderTagPreview",{attrs:{id:e.item.injected.fileid,name:e.item.injected.basename.toString(),path:e.item.injected.filename,"file-list":e.previewFiles}})},rt=[],ot=S(tt,it,rt,!1,null,"d8a42b05");const nt=ot.exports,b={400:{marginTop:66,marginW:8,count:3,folderCount:1},700:{marginTop:66,marginW:8,count:4,folderCount:1},1024:{marginTop:66,marginW:44,count:5,folderCount:2},1280:{marginTop:66,marginW:44,count:4,folderCount:2},1440:{marginTop:88,marginW:66,count:5,folderCount:3},1600:{marginTop:88,marginW:66,count:6,folderCount:4},2048:{marginTop:88,marginW:66,count:7,folderCount:4},2560:{marginTop:88,marginW:88,count:8,folderCount:6},3440:{marginTop:88,marginW:88,count:9,folderCount:8},max:{marginTop:88,marginW:88,count:10,folderCount:10}},C=new j({data(){return{gridConfig:b.max}},watch:{gridConfig(e){this.$emit("changed",e)}},created(){window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()},beforeDestroy(){window.removeEventListener("resize",this.handleWindowResize)},methods:{handleWindowResize(){const e=Object.keys(b).find(i=>i>document.documentElement.clientWidth);this.gridConfig=b[e]||b.max}}}),at={data(){return{gridConfig:{}}},created(){C.$on("changed",e=>{this.gridConfig=e}),_.debug("Grid config",{gridConfig:C.gridConfig}),this.gridConfig=C.gridConfig},beforeDestroy(){C.$off("changed",this.gridConfig)}},st={name:"Folders",components:{FolderIcon:H,HeaderNavigation:se,NcEmptyContent:oe,NcLoadingIcon:ee,UploadPicker:ne,VirtualGrid:qe},mixins:[B,at],props:{rootTitle:{type:String,required:!0},path:{type:String,default:"/"},showShared:{type:Boolean,default:!1}},data(){return{error:null,allowedMimes:U,initializing:!0,loading:!1,appContent:document.getElementById("app-content-vue"),uploader:ae()}},computed:{...q(["files","folders"]),folderId(){return this.$store.getters.folderId(this.path)},folder(){return this.files[this.folderId]},folderAsFolder(){return this.folder?new ie({...this.folder,source:decodeURI(this.folder.source),permissions:re(this.folder.permissions)}):null},folderContent(){return this.folders[this.folderId]||[]},fileList(){return this.folderContent&&this.folderContent.map(e=>this.files[e]).filter(e=>!!e)},subFolders(){return this.folderId&&this.files[this.folderId]&&this.files[this.folderId].folders},folderList(){return this.subFolders&&this.subFolders.map(e=>this.files[e]).filter(e=>!!e)},contentList(){const e=this.folderList?.map(r=>({id:`folder-${r.fileid}`,injected:{...r,showShared:this.showShared},width:232,height:280,columnSpan:1,renderComponent:nt})),i=this.fileList?.map(r=>({id:`file-${r.fileid}`,injected:{...r,list:this.fileList},width:256,height:256,columnSpan:1,renderComponent:Ye}));return[...e||[],...i||[]]},isEmpty(){return!this.haveFiles&&!this.haveFolders},haveFiles(){return!!this.fileList&&this.fileList.length!==0},haveFolders(){return!!this.folderList&&this.folderList.length!==0}},watch:{path(){this.fetchFolderContent()},showShared(){this.fetchFolderContent()}},beforeMount(){this.fetchFolderContent()},methods:{onRefresh(){this.fetchFolderContent()},async fetchFolderContent(){this.error=null,this.loading=!0,OCA?.Viewer?.close?.(),OCA?.Files?.Sidebar?.close?.(),(!this.files[this.folderId]||!this.folders[this.folderId])&&(this.initializing=!0);try{const{folder:e,folders:i,files:r}=await K(this.path,{shared:this.showShared,signal:this.abortController.signal});this.$store.dispatch("addPath",{path:this.path,fileid:e.fileid}),this.$store.dispatch("updateFolders",{fileid:e.fileid,files:r,folders:i}),this.$store.dispatch("updateFiles",{folder:e,files:r,folders:i})}catch(e){e.response&&e.response.status&&(e.response.status===404?(this.error=404,setTimeout(()=>{this.$router.push({name:this.$route.name})},3e3)):this.error=e),_.error("Error fetching album data",{error:e})}finally{this.loading=!1,this.initializing=!1}},async onUpload(e){const i=e.source.split(te).pop(),r=await le(i);this.$store.dispatch("appendFiles",[r]),this.$store.dispatch("addFilesToFolder",{fileid:this.folderId,files:[r]})}}};var lt=function(){var e=this,i=e._self._c;return e.error===404?i("NcEmptyContent",{attrs:{name:e.t("photos","This folder does not exist")},scopedSlots:e._u([{key:"icon",fn:function(){return[i("FolderIcon")]},proxy:!0}],null,!1,1472452094)}):e.error?i("NcEmptyContent",{attrs:{name:e.t("photos","An error occurred")}}):e.initializing?i("NcEmptyContent",{attrs:{name:e.t("photos","Loading folders …")},scopedSlots:e._u([{key:"icon",fn:function(){return[i("NcLoadingIcon")]},proxy:!0}])}):e.initializing?e._e():i("div",[i("HeaderNavigation",{key:"navigation",class:{"photos-navigation--uploading":e.uploader.queue?.length>0},attrs:{loading:e.loading,path:e.path,title:e.folder?.basename?.toString?.()||e.rootTitle,"root-title":e.rootTitle},on:{refresh:e.onRefresh}},[i("UploadPicker",{attrs:{accept:e.allowedMimes,destination:e.folderAsFolder,multiple:!0},on:{uploaded:e.onUpload}})],1),e.isEmpty?i("NcEmptyContent",{key:"emptycontent",attrs:{name:e.t("photos","No photos in here")},scopedSlots:e._u([{key:"icon",fn:function(){return[i("FolderIcon")]},proxy:!0}],null,!1,1472452094)}):i("div",{staticClass:"grid-container",class:{"grid-container--folders":e.haveFolders}},[i("VirtualGrid",{ref:"virtualgrid",attrs:{items:e.contentList,"scroll-element":e.appContent,"get-column-count":()=>e.haveFolders?e.gridConfig.folderCount:e.gridConfig.count,"get-grid-gap":()=>e.haveFolders?16:8}})],1)],1)},dt=[],ct=S(st,lt,dt,!1,null,"32ac8dc5");const _t=ct.exports;export{_t as default};
//# sourceMappingURL=Folders-B5u3N-a7.chunk.mjs.map
